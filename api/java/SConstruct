# This SConstruct builds and places the JAVA API Jar in the LIB FOLDER
# that is then installed to RSFROOT

import os,sys,string,re,shutil
sys.path.append('../..')
import configure
try:
    Import('env root libdir')
    env = env.Clone()
except:
    env = configure.Debug()
    root = None
    SConscript('../../plot/lib/SConstruct')

cp = None
try:
    cp = os.environ['MINESJTK']
except:
    print 'Could not find Mines JTK in classpath.'
    print 'Will not build Java API'


files = ['Header','Writer','Reader','Par']

targets = map(lambda x: 'rsf/'+x+'.class',files)
sources = map(lambda x: x+'.java',files)

pwd = os.getcwd()
if 'java' in env.get('API',[]) and cp:

        for i in range(len(files)):
            env.Command(targets[i],sources[i],['javac -cp %s:%s -d %s $SOURCE' % (cp,pwd,pwd)])

        env.Command('rsf.jar',targets,'jar cf $TARGET -C %s rsf/' %(pwd))
        env.Install('../../lib','rsf.jar')

        if root:
                env.Install(libdir,'rsf.jar')
