###########################################################################
import os, string

root = os.environ.get('RSFROOT')
libdir = os.path.join(root,'lib')
incdir = os.path.join(root,'include')

###########################################################################

import rsfproj

proj = rsfproj.Project()
proj['CXXFLAGS'] = string.replace(proj.get('CXXFLAGS',''),'-O2','-g')

############################################################################

test = '''
spike n1=1000 n2=100 n3=10 nsp=1 k1=500 | ./%s.exe clip=0.5 | attr
'''

test_matlab = '''
spike n1=1000 n2=100 n3=10 nsp=1 k1=500 > ${TARGETS[1]} &&
MATLABPATH=%s %s -nosplash -nojvm -nodesktop
-r "clip('${TARGETS[1]}','${TARGETS[2]}',0.5);quit" &&
attr < ${TARGETS[2]} > ${TARGETS[0]}
'''

api = proj.get('API',[])

############################################################################
# Matlab API
############################################################################

matlab = WhereIs('matlab')

if matlab and 'matlab' in api:
    mattest = proj.Flow('mat spike out','clip.m',
                        test_matlab % (libdir,matlab),
                        suffix='.attr',stdin=0,stdout=-1)
    Default(mattest)

############################################################################

proj.End()
