import os, rsfdoc

Import('env')

root = env.get('RSFROOT')

bindir = os.path.join(root,'bin')
libdir = os.path.join(root,'lib')
docdir = os.path.join(root,'doc')

dirs = ['main','proc','imag','plot','libplot']+env['USERS']

env.Command('rsfprog.py',None,
            action=Action(rsfdoc.getprogs,varlist=['dirs']),dirs=dirs)

for src in ('doc','proj','prog','tex','book'):
    py = 'rsf%s.py' % src
    env.Install(libdir,py)
# clean .pyc files?

env.Install(libdir,'suproj.py')

for src in ('latex2wiki','vplot2eps','vplot2gif','vplot2avi'):
    if (src != 'vplot2gif' and src != 'vplot2avi' ) or env.get('PPM'):
        env.Install(libdir,src+'.py')
        env.InstallAs(os.path.join(bindir,src),src+'.py')

for src in ('doc','tour','units'):
    env.Install(bindir,'sf'+src)

use = os.path.join(libdir,'rsfuse.py')
env.Command(use,None,action=Action(rsfdoc.use,varlist=['book']),book='book')
Depends(use,map(lambda x: os.path.join(libdir,'sf'+x+'.py'),dirs))
Depends(use,os.path.join(libdir,'vpplot.py'))
Depends(use,os.path.join(libdir,'suproj.py'))

index = os.path.join(docdir,'index.html')
repos = os.environ.get('RSF_REPOSITORY',os.getcwd())
env.Append(ENV={'LD_LIBRARY_PATH':os.environ.get('LD_LIBRARY_PATH'),
                'PYTHONPATH':os.environ.get('PYTHONPATH')})
env.Command(index,None,
            '%s python/sfdoc -w %s -r %s' % (WhereIs('python'),docdir,repos))
Depends(index,use)

##########################################################################
# SELF DOCUMENTATION
##########################################################################
Doc = Builder (action = Action(rsfdoc.selfdoc,varlist=['rsfprefix','lang']),
               src_suffix='.c',suffix='.py')
Place = Builder (action = Action(rsfdoc.placeholder,varlist=['var','package']))
env.Append(BUILDERS = {'Doc' : Doc, 'Place' : Place})
