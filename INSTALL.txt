=======================
Madagascar Installation
=======================

Prerequisites
=============

   1. C compiler. ANSI-compliant compiler such as GCC should work. GCC
   usually comes pre-installed on Linux machines.

   2. Python interpreter. Python is an interpretable programming
   language. It is used in Madagascar installation scripts and project
   management scripts. Python comes pre-installed on some platforms.
   
Madagascar currently attempts to support Python versions 2.2 through
2.6. Versions before 2.2 are probably not common, but if you experience
problems and you have an earlier version you should probably upgrade.
   
SCons is also required, but it is included with Madagascar and the
configure scripts will attempt to install it for you if you don't have
it already.

For more information see:
http://reproducibility.org/wiki/Main_Page
http://reproducibility.org/wiki/Installation
http://reproducibility.org/wiki/Advanced_Installation

Environmental variables
=======================

To set environmental variables, append the content of env.sh or
env.csh (depending on which shell you are using) to ~/.bash_profile or
~/.chsrc, respectively.

Running 

	source env.sh

or

	source env.csh

should also work.

If you do not know which shell you are using, type the following at the
command line:

	printenv SHELL

You may want to edit the DATAPATH variable (notice the slash at the end).

Software construction
=====================

   1. Configuration.

      Change to the top RSF source directory and run

      ./configure

      You can examine the config.py file that this command
generates. Additional options are available. You can obtain a full
list of customizable variables by running "scons -h". For example, to
install C++ and Fortran-90 API bindings in addition to the basic
package, run

      ./configure API=c++,fortran-90

   2. Building and installing the package.

      Run "make install" or the following two commands in succession:

      make 
      make install

      If you need "root" privileges for installing under $RSFROOT, you
may need to run

      make
      su
      make install

      or

      make
      sudo make install

   3. Cleaning.

      To clean all intermediate files generated by SCons, run

      make clean

      To clean all intermediate files and all installed files, run

      make distclean

Testing Your Installation
=========================

Here are a few simple tests and and a brief introduction to Madagascar:

Typing any Madagascar command in a terminal window without parameters should
generate a brief documentation on that command. Try one of the following:

	sfin
	sfattr
	sfspike
	sfbandpass
	sfwiggle

If you get an error like "Command not found", you may not have your
PATH environment variable set correctly, or you may need to
issue the rehash command.

Now try making a simple Madagascar data file:

	sfspike n1=1000 k1=300 > spike.rsf

This command generates a one dimensional list of 1000 numbers, all zero except
for a spike equal to one at position 300. If this generates an error like

	Cannot write to data file /path/spike.rsf@: Bad file descriptor

you may need to create the directory pointed to by your DATAPATH
environment variable.

The file spike.rsf is a text header.  The actual data are stored in
the binary file pointed to by the in parameter in the header.  You
can look at the header file directly with more, or better, examine
the file properties with

	sfin spike.rsf

You can learn more about the contents of spike.rsf with

	sfattr < spike.rsf


The following command applies a bandpass filter to spike.rsf and puts
the result in filter.rsf:

	sfbandpass fhi=2 phase=1 < spike.rsf > filter.rsf

The following command makes a graphics file from filter.rsf:

	sfwiggle clip=0.02 title="Welcome to Madagascar" < filter.rsf > filter.vpl

If you have an X11 display program running, and your DISPLAY
environment variable is set correctly, you can display the graphics file with:

	sfpen < filter.vpl

You can pipe Madagascar commands together and do the whole thing at once like
this:

	sfspike n1=1000 k1=300 | sfbandpass fhi=2 phase=1 | \
	sfwiggle clip=0.02 title="Welcome to Madagascar" | sfpen

If you have SCons installed, you can use it to automate Madagascar processing.
Here is a simple SConstruct file to make filter.rsf and filter.vpl :

####################################
#
# Setting up
#
from rsf.proj import *

#
# Make filter.rsf
#
Flow('filter',None,
     'spike n1=1000 k1=300 | bandpass fhi=2 phase=1')

#
# Make filter.vpl
#
Result('filter',
       'wiggle clip=0.02 title="Welcome to Madagascar"')

End()
####################################

Put the file in an empty directory, give it the name SConstruct,
cd to that directory, and issue the command:

	scons

The graphics file is now stored in the Fig subdirectory.  You can
view it manually with:

	sfpen Fig/filter.vpl

... or you can use:

	scons view

When an SConstruct file makes more than one graphics file, the  

	scons view 

command will display all of them in sequence. 

Now edit the SConstruct file: change the title string on the
Result line to "Hello World!", save the file, and rerun the scons
command. 

You will see that scons has figured out that the file
filter.rsf does not need to be rebuilt because nothing that affects
it has changed. Only the file filter.vpl is rebuilt.

Bugs
====

Please report all problems encountered during software construction to
the RSF-user mailing list:

https://lists.sourceforge.net/lists/listinfo/rsf-user

You can also send suggestions for improvement of this document to the list.
