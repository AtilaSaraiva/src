###########################################################################
# STANDARD HEADER
###########################################################################
import sys, os

root = os.environ.get('RSFROOT')
sys.path.append(os.path.join(root,'lib'))

from rsfproj import *
##########################################################################
Book()

datdir  = 'ftp://begpc132.beg.utexas.edu/data/galilee'
Fetch('galilee.H',datdir)

base = -212

Flow('data','galilee.H','dd data_format=native_float')
Flow('mask','data','window n1=1 f1=2 | mask max=%g' % base)
Flow('gal',['data','mask'],'headerwindow mask=${SOURCES[1]}')

def plot(title,allpos=0):
    return '''
    grey allpos=%d pclip=94
    crowd=.82 title="%s" yreverse=n transp=n
    label2="north-south (km)" label1="west-east (km)"
    ''' % (allpos,title)

Flow('mesh','gal',
     '''
     window n1=1 f1=2 |
     headermath depth=0 output=%g-depth |
     bin interp=1 xkey=0 ykey=1 head=$SOURCE
     xmin=198 xmax=212 ymin=233 ymax=257
     nx=280 ny=440
     ''' % base)
Plot('mesh','mesh',plot('Binned',1))

Flow('fill','mesh','lapfill grad=y niter=20')
Plot('fill','fill',plot('Missing filled',1))
Plot('cros','fill',
     '''window j2=20 |
     graph yreverse=y crowd=.82 label1="west-east (km)" label2="depth (m)"
     wherexlabel=t
     ''')
Plot('ruf2','fill','igrad | ' + plot('Filled and d/dx'))

Combine('locfil','mesh fill cros ruf2','TwoByTwo',result=1)

###########################################################################
End()
