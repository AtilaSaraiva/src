
     <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
     <html>
     <head>
     <title>helix/SConstruct</title>
     <style type="text/css">
     div.progs {
     background-color: #DCE3C4;
     border: thin solid black;
     padding: 1em;
     margin-left: 2em;
     margin-right: 2em; }
     div.dsets {
     background-color: #E3C4DC;
     border: thin solid black;
     padding: 1em;
     margin-left: 2em;
     margin-right: 2em; }
     div.scons {
     background-color: #FFF8ED;
     border: thin solid black;
     padding: 1em;
     margin-left: 2em;
     margin-right: 2em; }
     .name { color: #000000; }
.number { color: #0080C0; }
.string { color: #004080; }
.keyword { color: #C00000; }
.flow { color: #0000C0; }
.text { color: #000000; }
.fetch { color: #0000C0; }
.op { color: #0000C0; }
.error { color: #FF8080; }
.comment { color: #008000; }
.plot { color: #0000C0; }
.result { color: #C00000; }
</style>
     </head>
     <body>
     <div>
     <a href="paper_html/paper.html"><img width="32" height="32"
     align="bottom" border="0" alt="up" src="paper_html/icons/up.png"></a>
     <a href="paper.pdf"><img src="paper_html/icons/pdf.png" alt="[pdf]"
     width="32" height="32" border="0"></a>
     </div>
     <div class="scons">
     <table><tr><td>
     <pre><font face="Lucida,Courier New"><span class="keyword">from</span> <span class="name">rsf</span><span class="op">.</span><span class="name">proj</span> <span class="keyword">import</span> <span class="op">*</span>
<span class="keyword">import</span> <span class="name">math</span>

<span class="comment"># Download data</span>
<span class="name">txt</span> <span class="op">=</span> <span class="string">'st-helens_after.txt'</span>
<span class="fetch">Fetch</span><span class="op">(</span><span class="name">txt</span><span class="op">,</span><span class="string">'data'</span><span class="op">,</span>
      <span class="name">server</span><span class="op">=</span><span class="string">'https://raw.githubusercontent.com'</span><span class="op">,</span>
      <span class="name">top</span><span class="op">=</span><span class="string">'agile-geoscience/notebooks/master'</span><span class="op">)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'data.asc'</span><span class="op">,</span><span class="name">txt</span><span class="op">,</span><span class="string">'/usr/bin/tail -n +6'</span><span class="op">)</span>

<span class="comment"># Convert to RSF format</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'data'</span><span class="op">,</span><span class="string">'data.asc'</span><span class="op">,</span>
     <span class="string">'''
     echo in=$SOURCE data_format=ascii_float
     label=Elevation unit=m
     n1=979  o1=557.805  d1=0.010030675 label1=X
     n2=1400 o2=5107.965 d2=0.010035740 label2=Y |
     dd form=native | 
     clip2 lower=0 | lapfill grad=y niter=200 
     '''</span><span class="op">)</span>

<span class="result">Result</span><span class="op">(</span><span class="string">'data'</span><span class="op">,</span><span class="string">'grey title="Digital Elevation Map" allpos=y'</span><span class="op">)</span>

<span class="comment"># Vertical and horizontal derivatives</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'der1'</span><span class="op">,</span><span class="string">'data'</span><span class="op">,</span><span class="string">'igrad'</span><span class="op">)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'der2'</span><span class="op">,</span><span class="string">'data'</span><span class="op">,</span><span class="string">'transp | igrad | transp'</span><span class="op">)</span>

<span class="name">ders</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span>
<span class="keyword">for</span> <span class="name">alpha</span> <span class="keyword">in</span> <span class="name">range</span><span class="op">(</span><span class="number">0</span><span class="op">,</span><span class="number">360</span><span class="op">,</span><span class="number">10</span><span class="op">)</span><span class="op">:</span>
    <span class="name">der</span> <span class="op">=</span> <span class="string">'der%d'</span> <span class="op">%</span> <span class="name">alpha</span>

    <span class="comment"># Directional derivative</span>
    <span class="flow">Flow</span><span class="op">(</span><span class="name">der</span><span class="op">,</span><span class="string">'der1 der2'</span><span class="op">,</span>
         <span class="string">'''
         add ${SOURCES[1]} scale=%g,%g
         '''</span> <span class="op">%</span> <span class="op">(</span><span class="name">math</span><span class="op">.</span><span class="name">cos</span><span class="op">(</span><span class="name">alpha</span><span class="op">*</span><span class="name">math</span><span class="op">.</span><span class="name">pi</span><span class="op">/</span><span class="number">180</span><span class="op">)</span><span class="op">,</span>
                <span class="name">math</span><span class="op">.</span><span class="name">sin</span><span class="op">(</span><span class="name">alpha</span><span class="op">*</span><span class="name">math</span><span class="op">.</span><span class="name">pi</span><span class="op">/</span><span class="number">180</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="name">ders</span><span class="op">.</span><span class="name">append</span><span class="op">(</span><span class="name">der</span><span class="op">)</span>

<span class="flow">Flow</span><span class="op">(</span><span class="string">'ders'</span><span class="op">,</span><span class="name">ders</span><span class="op">,</span>
     <span class="string">'''
     cat axis=3 ${SOURCES[1:%d]} |
     put o3=0 d3=10
     '''</span> <span class="op">%</span> <span class="name">len</span><span class="op">(</span><span class="name">ders</span><span class="op">)</span><span class="op">)</span>

<span class="comment"># Semblance</span>

<span class="flow">Flow</span><span class="op">(</span><span class="string">'ders2'</span><span class="op">,</span><span class="string">'ders'</span><span class="op">,</span><span class="string">'mul $SOURCE'</span><span class="op">)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'stack'</span><span class="op">,</span><span class="string">'ders2'</span><span class="op">,</span><span class="string">'stack axis=2 norm=n | stack axis=1 norm=n'</span><span class="op">)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'stack2'</span><span class="op">,</span><span class="string">'ders2'</span><span class="op">,</span>
     <span class="string">'mul $SOURCE | stack axis=2 norm=n | stack axis=1 norm=n'</span><span class="op">)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'sembl'</span><span class="op">,</span><span class="string">'stack stack2'</span><span class="op">,</span>
     <span class="string">'mul ${SOURCES[0]} | div ${SOURCES[1]} | scale axis=1'</span><span class="op">)</span>
<span class="result">Result</span><span class="op">(</span><span class="string">'sembl'</span><span class="op">,</span>
       <span class="string">'graph title=Semblance label1=Degree unit1="\^o\_" '</span><span class="op">)</span>

<span class="plot">Plot</span><span class="op">(</span><span class="string">'ders'</span><span class="op">,</span><span class="string">'grey gainpanel=all wanttitle=n'</span><span class="op">,</span><span class="name">view</span><span class="op">=</span><span class="number">1</span><span class="op">)</span>

<span class="comment"># !!! MODIFY BELOW !!! </span>
<span class="name">alpha</span><span class="op">=</span><span class="number">30</span>

<span class="result">Result</span><span class="op">(</span><span class="string">'der'</span><span class="op">,</span><span class="string">'der%d'</span> <span class="op">%</span> <span class="name">alpha</span><span class="op">,</span>
       <span class="string">'''
       grey title="Directional Derivative at %g\^o\_" 
       '''</span> <span class="op">%</span> <span class="name">alpha</span><span class="op">)</span>

<span class="comment"># Laplacian filter on a helix (!!! MODIFY !!!)</span>

<span class="flow">Flow</span><span class="op">(</span><span class="string">'slag0.asc'</span><span class="op">,</span><span class="name">None</span><span class="op">,</span>
     <span class="string">'''echo 1 1000 n1=2 n=1000,1000 
     data_format=ascii_int in=$TARGET 
     '''</span><span class="op">)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'slag'</span><span class="op">,</span><span class="string">'slag0.asc'</span><span class="op">,</span><span class="string">'dd form=native'</span><span class="op">)</span>

<span class="flow">Flow</span><span class="op">(</span><span class="string">'ss0.asc'</span><span class="op">,</span><span class="string">'slag'</span><span class="op">,</span>
     <span class="string">'''echo -1 -1 a0=2 n1=2
     lag=$SOURCE in=$TARGET data_format=ascii_float'''</span><span class="op">)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'ss'</span><span class="op">,</span><span class="string">'ss0.asc'</span><span class="op">,</span><span class="string">'dd form=native'</span><span class="op">)</span>

<span class="comment"># Wilson-Burg factorization</span>

<span class="name">na</span><span class="op">=</span><span class="number">50</span> <span class="comment"># filter length</span>

<span class="name">lags</span> <span class="op">=</span> <span class="name">range</span><span class="op">(</span><span class="number">1</span><span class="op">,</span><span class="name">na</span><span class="op">+</span><span class="number">1</span><span class="op">)</span> <span class="op">+</span> <span class="name">range</span><span class="op">(</span><span class="number">1002</span><span class="op">-</span><span class="name">na</span><span class="op">,</span><span class="number">1002</span><span class="op">)</span>

<span class="flow">Flow</span><span class="op">(</span><span class="string">'alag0.asc'</span><span class="op">,</span><span class="name">None</span><span class="op">,</span>
     <span class="string">'''echo %s n=1000,1000 n1=%d in=$TARGET 
     data_format=ascii_int
     '''</span> <span class="op">%</span> <span class="op">(</span><span class="string">' '</span><span class="op">.</span><span class="name">join</span><span class="op">(</span><span class="name">map</span><span class="op">(</span><span class="name">str</span><span class="op">,</span><span class="name">lags</span><span class="op">)</span><span class="op">)</span><span class="op">,</span><span class="number">2</span><span class="op">*</span><span class="name">na</span><span class="op">)</span><span class="op">)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'alag'</span><span class="op">,</span><span class="string">'alag0.asc'</span><span class="op">,</span><span class="string">'dd form=native'</span><span class="op">)</span>

<span class="flow">Flow</span><span class="op">(</span><span class="string">'hflt hlag'</span><span class="op">,</span><span class="string">'ss alag'</span><span class="op">,</span>
     <span class="string">'wilson lagin=${SOURCES[1]} lagout=${TARGETS[1]}'</span><span class="op">)</span>

<span class="comment"># Helical derivative</span>

<span class="flow">Flow</span><span class="op">(</span><span class="string">'helder'</span><span class="op">,</span><span class="string">'data hflt hlag'</span><span class="op">,</span><span class="string">'helicon filt=${SOURCES[1]}'</span><span class="op">)</span>
<span class="result">Result</span><span class="op">(</span><span class="string">'helder'</span><span class="op">,</span><span class="string">'grey title="Helical Derivative" '</span><span class="op">)</span>

<span class="keyword">def</span> <span class="name">plotfilt</span><span class="op">(</span><span class="name">title</span><span class="op">)</span><span class="op">:</span>
    <span class="keyword">return</span> <span class="string">'''
    window n1=11 n2=11 f1=50 f2=50 |
    grey wantaxis=n title="%s" pclip=100 
    crowd=0.85 screenratio=1
    '''</span> <span class="op">%</span> <span class="name">title</span>

<span class="comment"># Laplacian impulse response</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'spike'</span><span class="op">,</span><span class="name">None</span><span class="op">,</span><span class="string">'spike n1=111 n2=111 k1=56 k2=56'</span><span class="op">)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'imp0'</span><span class="op">,</span><span class="string">'spike ss'</span><span class="op">,</span><span class="string">'helicon filt=${SOURCES[1]} adj=0'</span><span class="op">)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'imp1'</span><span class="op">,</span><span class="string">'spike ss'</span><span class="op">,</span><span class="string">'helicon filt=${SOURCES[1]} adj=1'</span><span class="op">)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'imp'</span><span class="op">,</span><span class="string">'imp0 imp1'</span><span class="op">,</span><span class="string">'add ${SOURCES[1]}'</span><span class="op">)</span>
<span class="plot">Plot</span><span class="op">(</span><span class="string">'imp'</span><span class="op">,</span><span class="name">plotfilt</span><span class="op">(</span><span class="string">'(a) Laplacian'</span><span class="op">)</span><span class="op">)</span>

<span class="comment"># Test factorization</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'fac0'</span><span class="op">,</span><span class="string">'imp hflt'</span><span class="op">,</span>
     <span class="string">'helicon filt=${SOURCES[1]} adj=0 div=1'</span><span class="op">)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'fac1'</span><span class="op">,</span><span class="string">'imp hflt'</span><span class="op">,</span>
     <span class="string">'helicon filt=${SOURCES[1]} adj=1 div=1'</span><span class="op">)</span>
<span class="plot">Plot</span><span class="op">(</span><span class="string">'fac0'</span><span class="op">,</span><span class="name">plotfilt</span><span class="op">(</span><span class="string">'(b) Laplacian/Factor'</span><span class="op">)</span><span class="op">)</span>
<span class="plot">Plot</span><span class="op">(</span><span class="string">'fac1'</span><span class="op">,</span><span class="name">plotfilt</span><span class="op">(</span><span class="string">'(c) Laplacian/Factor\''</span><span class="op">)</span><span class="op">)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">'fac'</span><span class="op">,</span><span class="string">'fac0 hflt'</span><span class="op">,</span>
     <span class="string">'helicon filt=${SOURCES[1]} adj=1 div=1'</span><span class="op">)</span>
<span class="plot">Plot</span><span class="op">(</span><span class="string">'fac'</span><span class="op">,</span><span class="name">plotfilt</span><span class="op">(</span><span class="string">'(d) Laplacian/Factor/Factor\''</span><span class="op">)</span><span class="op">)</span>

<span class="result">Result</span><span class="op">(</span><span class="string">'laplace'</span><span class="op">,</span><span class="string">'imp fac0 fac1 fac'</span><span class="op">,</span><span class="string">'TwoRows'</span><span class="op">,</span>
       <span class="name">vppen</span><span class="op">=</span><span class="string">'gridsize=5,5 xsize=11 ysize=11'</span><span class="op">)</span>

<span class="name">End</span><span class="op">(</span><span class="op">)</span><span class="text"></span></font></pre></table></div><p><div class="progs"><table width="100%" summary="list"><tr><td width="25%" valign=top><a href="http://www.ahay.org/RSF/sfdd.html">sfdd</a><br>
<a href="http://www.ahay.org/RSF/sfclip2.html">sfclip2</a><br>
<a href="http://www.ahay.org/RSF/sflapfill.html">sflapfill</a><br>
<a href="http://www.ahay.org/RSF/sfgrey.html">sfgrey</a><br>
<a href="http://www.ahay.org/RSF/sfigrad.html">sfigrad</a><br>
</td><td width="25%" valign=top><a href="http://www.ahay.org/RSF/sftransp.html">sftransp</a><br>
<a href="http://www.ahay.org/RSF/sfadd.html">sfadd</a><br>
<a href="http://www.ahay.org/RSF/sfcat.html">sfcat</a><br>
<a href="http://www.ahay.org/RSF/sfput.html">sfput</a><br>
<a href="http://www.ahay.org/RSF/sfadd.html">sfmul</a><br>
</td><td width="25%" valign=top><a href="http://www.ahay.org/RSF/sfstack.html">sfstack</a><br>
<a href="http://www.ahay.org/RSF/sfadd.html">sfdiv</a><br>
<a href="http://www.ahay.org/RSF/sfscale.html">sfscale</a><br>
<a href="http://www.ahay.org/RSF/sfgraph.html">sfgraph</a><br>
<a href="http://www.ahay.org/RSF/sfwilson.html">sfwilson</a><br>
</td><td width="25%" valign=top><a href="http://www.ahay.org/RSF/sfhelicon.html">sfhelicon</a><br>
<a href="http://www.ahay.org/RSF/sfspike.html">sfspike</a><br>
<a href="http://www.ahay.org/RSF/sfwindow.html">sfwindow</a><br>
</td></tr></table></div><p><div class="dsets"><table width="100%" summary="list"><tr><td width="25%" valign=top><a href="https://raw.githubusercontent.com/agile-geoscience/notebooks/master/data/st-helens_after.txt">https://raw.githubusercontent.com/agile-geoscience/notebooks/master/data/st-helens_after.txt</a><br>
</td><td width="25%" valign=top></td><td width="25%" valign=top></td><td width="25%" valign=top></td></tr></table>
     </div>
     </body>
     </html>
     