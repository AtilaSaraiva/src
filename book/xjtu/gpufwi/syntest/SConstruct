from rsf.proj import *

nz=100
nx=120
dz=5	#unit: m
dx=5	#unit: m

Flow('vel','syn100x120.bin',
	'''
	sfbin2rsf n1=%d n2=%d d1=%g d2=%g 
	'''%(nz,nx,dz,dx))
Plot('vel',
	'''
	sfput label1=Depth unit1=m \
	label2=Distance unit2=m | 
	grey allpos=y scalebar=y color=j
	screenratio=0.45 
	''')
  
Flow('smvel',None,
	'''
	math output=1600 n1=%d n2=%d d1=%g d2=%g 
	'''%(nz,nx,dz,dx))
Plot('smvel',
     ''' 
	grey allpos=y scalebar=y color=j
	screenratio=0.45 
     ''' )

Result('all','vel smvel','TwoRows')


Flow('shots','vel',
	'''
	sfgenshots csdgather=n fm=20 amp=1 dt=0.0015 ns=12 ng=120 nt=800
	sxbeg=5 szbeg=2 jsx=10 jsz=0 gxbeg=0 gzbeg=3 jgx=1 jgz=0
	''')
Result('shots','grey color=g ')

Flow('vsnaps grads objs illums','smvel shots',
	'''
	sfgpufwi shots=${SOURCES[1]} grads=${TARGETS[1]} objs=${TARGETS[2]}
	illums=${TARGETS[3]} niter=10
	''')
Result('vsnaps',
	'''
	grey title="Updated velocity" allpos=y color=j pclip=100 
	scalebar=y bartype=v barlabel="V" barunit="m/s" 
	''')

Result('grads','grey title="Updated gradient" scalebar=y color=j ')
Result('illums','grey title="illumination" scalebar=y color=j')

Result('objs',
	'''
	graph title="Normalized Misfit" dash=0 plotfat=5 label1=Iteration 
	label2=Objective grid=y yreverse=n
	''')





End()
