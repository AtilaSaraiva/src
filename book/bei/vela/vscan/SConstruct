###########################################################################
# STANDARD HEADER
###########################################################################
import sys, os

root = os.environ.get('RSFROOT')
sys.path.append(os.path.join(root,'lib'))

from rsfproj import *
###########################################################################
Book()

Flow('mod',None,
     '''
     spike n1=75 n2=35 d1=0.0533333 d2=0.0242157 o1=0 o2=0.01
     nsp=5 mag=2,1,1,1,1 k1=11,18,33,56,70 k2=28,19,19,19,19
     ''')
Flow('dat','mod','velmod h0=-1 dh=0.141026 nh=40 slowness=y half=n')
Flow('mod2','dat','vscan slowness=y half=n')
Flow('dat2','mod2','velmod slowness=y half=n')

for data in ('mod','dat','mod2','dat2'):
    Plot(data,data,
         '''
         dots gaineach=0 dots=0 seemean=1 strings=0
         constsep=1 overlap=6. transp=1 label1=" "
         ''')
Combine('top','mod dat','SideBySideAniso')
Combine('bot','mod2 dat2','SideBySideAniso')
Combine('velvel','top bot','OverUnderAniso',result=1)

midpts = 'ftp://begpc132.beg.utexas.edu/data/midpts'
Fetch('midpts.HH',midpts)

Flow('cdp','midpts.HH','window n3=1 j1=2 | dd data_format=native_float')
Flow('mutter','cdp','mutter half=n v0=1.4') 
Flow('veltran','mutter','vscan slowness=y half=n v0=0.3 nv=81 dv=0.005')

sides = ['mutter','veltran']
for case in sides:
    Plot(case,case,'grey wanttitle=n')
Combine('mutvel',sides,'SideBySideAniso',result=1,vppen='txscale=1.5')

Flow('wgmutter','midpts.HH',
     'dd data_format=native_float | mutter half=n v0=1.4')

Flow('wgfit','wgmutter',
     '''
     vscan slowness=y half=n v0=0.3 nv=81 dv=0.005 semblance=y |
     blindpick2 eps=25 lam=25
     ''')

def graph(col=7,fat=1):
    return '''
    graph min2=0.3 max2=0.7 pad=n transp=y yreverse=y wanttitle=n
    plotcol=%d plotfat=%d
    ''' % (col,fat)

Flow('fit','wgfit','window n3=1')
Plot('slow','slowfit',graph(1,1))
Plot('fatslow','slowfit',graph(0,7))
Combine('fit','veltran fatslow slow','Overlay',result=1) 

Flow('wgstack',['wgmutter','wgfit'],
     'nmo velocity=${SOURCES[1]} slowness=y half=n | stack')
Result('wgstack','wgstack','grey title=Stack')

Flow(['agcstack','ref'],'wgstack',
     '''
     math output="abs(input)" |
     smooth rect1=125 > ${TARGETS[1]};
     add mode=d ${SOURCES[0]} ${TARGETS[1]}
     ''')
Result('agcstack','agcstack','grey title="AGC Stack" ')

###########################################################################
End()

