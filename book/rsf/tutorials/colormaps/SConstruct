from rsf.proj import *
from rsf.prog import RSFROOT
import os

Flow('random',None,'math n1=8 n2=8 output=1 | noise rep=y seed=2014 type=n mean=0.5')

Result('spectral','random',
       '''
       grey pclip=100 mean=y color=spectral screenratio=0.9 scalebar=y 
       title=spectral
       ''')

Flow('bar',None,'math n1=16 output=x1')

Result('bar',
       '''
       grey allpos=y pclip=100 color=spectral title=Colors wantaxis=n 
       screenht=2 screenwd=14 transp=n wheretitle=t
       ''')

# Get color pallette

csv = os.path.join(RSFROOT,'include','spectral.csv')

Flow('spectral',csv,'csv2rsf')

# Interpolate 16 numbers

Flow('num16','spectral','transp | remap1 o1=0 n1=16 d1=%g | scale dscale=255' % (255.0/15))

# Compute intensity

Flow('intensity','num16','stack scale=0.2989,0.5870,0.1140 norm=n')

Plot('intensity',
     '''
     grey allpos=y pclip=100 title=Intensity wantaxis=n 
     screenht=2 screenwd=14 transp=n wheretitle=t
     ''')

Result('intensity','Overlay')

Plot('intensity2','intensity',
     '''
     graph symbol=o min2=0 max2=255 wanttitle=n label2= unit2= parallel2=n
     screenht=2 screenwd=14 wantaxis1=n labelsz=5 symbolsz=5 plotcol=2
     ''')

Result('intensity2','intensity intensity2','Overlay')

# Sort by intensity

Result('isorted','intensity',
       '''
       transp | headersort head=$SOURCE | window |
       grey allpos=y pclip=100
       title="Sorted color intensity" wantaxis=n 
       screenht=2 screenwd=14 transp=n wheretitle=t
       ''')

Flow('sorted','intensity',
     '''
     math output=x1 |
     transp | headersort head=$SOURCE | window
     ''')

Result('sorted',
       '''
       grey allpos=y pclip=100 color=spectral
       title="Colors sorted by intensity" wantaxis=n 
       screenht=2 screenwd=14 transp=n wheretitle=t
       ''')

# Plotted as Euclidean distance

Flow('euclid','intensity','bin1 x0=0 dx=1 nx=256 head=$SOURCE')

Result('euclid',
       '''
       grey allpos=y pclip=100 
       title="Color intensity, Euclidean distance" wantaxis=n 
       screenht=2 screenwd=14 transp=n wheretitle=t
       ''')

# Now let us try other palettes

Result('linear','random',
       '''
       grey pclip=100 mean=y color=linearlfb screenratio=0.9 scalebar=y 
       title=linearlfb
       ''')

End()
