# **** MACHINE MADE MAKEFILE (by makemake) ****

# This makefile is generated by executing the "makemake" perl script
# in this directory. To generate a makefile for all chapter directories 
# in a book, you execute "Tour makemake" in the Adm directory.

include ${SEPINC}/SEP.top
UF90LIBS = ${GEELIB}

RESULTSER = plane \
	fft-imp fft-inv cheb1-imp cheb2-imp cheb1-inv cheb2-inv mig1 mig2 mig-impl \
	fd-imp t2 t2-fft cheb1 cheb2 cheb1-fft cheb2-fft cheb-impl

Makefile : ;

.PRECIOUS: %.x

spike.H: spike.p
	Spike  par=spike.p | Bandpass flo=10 fhi=50 > spike.H

mod.H: Sigmoid.x  kirsig.p 3.p 
	Sigmoid.x par=kirsig.p par=3.p >junk.H	
	<junk.H Smooth par=kirsig.p diff1=1 > smoo.H
	<smoo.H Smooth par=kirsig.p |Scale dscale=150 >mod.H

dat.H: mod.H Stolt.x Cosft.x
	<mod.H Pad n2out=257 > pad.H
	<pad.H Cosft.x sign2=1 | \
	Stolt.x pad=513 vel=-1.5 | \
	Cosft.x sign2=-1 >sto.H
	echo "d1=0.004" >> sto.H
	<sto.H Window n2=200 >dat.H

t2.H: dat.H T2.x
	<dat.H T2.x dens=2 >t2.H

cheb-%.H: dat.H Cheb%.x
	<dat.H Cheb$*.x dens=2 >cheb-$*.H

${RESDIR}/t2.v: dat.H t2.H
	<dat.H Grey title="Input data" >dat.V
	<t2.H Grey  label1="sec^2" title="After t^2 transform" >t2.V        
	Vppen < dat.V t2.V vpstyle=n size=r gridnum=2,1 >/dev/null out=$@

${RESDIR}/cheb%.v: dat.H cheb-%.H
	<dat.H Grey title="Input data" >dat.V
	Cat cheb-$*.H > junk.H
	echo "o1=0 d1=.007854" >> junk.H
	<junk.H Grey  label1=" " \
	title="Transformation to Chebyshev grid" >cheb2.V        
	Vppen < dat.V cheb2.V vpstyle=n size=r gridnum=2,1 >/dev/null out=$@

t2-fft.H: t2.H FFT.x
	<t2.H Pad n1out=0 n2out=0 |Rtoc|FFT.x sign1=1 sign2=1 > t2-fft.H

oper.H:  t2-fft.H VCop.x
	<t2-fft.H  VCop.x vel=1 >oper.H

cheb1%.H: dat.H Chebysh.x Cheb%.x
	<dat.H Pad n1out=0 | Cheb$*.x dens=2 | Chebysh.x > cheb1$*.H

cheb%-fft.H: cheb1%.H Cosft.x
	<cheb1$*.H Pad n2out=257 | Cosft.x sign2=1 >cheb$*-fft.H

${RESDIR}/t2-fft.v: t2-fft.H oper.H
	<t2-fft.H Real | Window min1=0 | Grey title="Data FFT Real Part" \
	label1="Frequency (1/sec^2)" label2="Wavenumber (1/km)" >data.V
	<oper.H Real | Window min1=0 | Grey title="Operator FFT Real Part" \
	label1="Frequency (1/sec^2)" label2="Wavenumber (1/km)" >oper.V
	Vppen < data.V oper.V vpstyle=n size=r gridnum=2,1 >/dev/null out=$@

${RESDIR}/cheb%-fft.v: cheb1%.H cheb%-fft.H
	<cheb1$*.H Grey title="Chebyshev transform" \
	label1="Polynom number" o1=0 d1=1 >cheb.V
	<cheb$*-fft.H Grey title="Chebyshev-Cosine FT" \
	label1="Polynom number" o1=0 d1=1 label2="wavenumber (1/km)" >fft.V
	Vppen < cheb.V fft.V vpstyle=n size=r gridnum=2,1 >/dev/null out=$@

${RESDIR}/mig%.v: mod.H dat.H t2-fft.H Prod.x FFT.x Cosft.x \
		 T2.x cheb%-fft.H Pseudo%.x Chebysh.x Cheb%.x
	<mod.H Grey title="Ideal image" >mod.V
	<dat.H Grey title="Input data" >dat.V
	<t2-fft.H  VCop.x vel=0.75 | Prod.x prod=t2-fft.H >out.H
	<out.H FFT.x sign1=-1 sign2=-1 | Real >real.H
	<real.H Window n1=400 n2=200 | T2.x inv=1 dens=2 >fft2.H
	<fft2.H Grey title="Fourier result" >fft.V
	<cheb$*-fft.H Pseudo$*.x vel=0.75 nv=5000 >out.H
	<out.H Cosft.x sign2=-1 | Window n2=200 | Chebysh.x inv=1 >real.H
	<real.H Cheb$*.x inv=1 dens=2 | Window n1=200 >cheb.H
	<cheb.H Grey title="Chebyshev result" >cheb.V
	Vppen < mod.V dat.V fft.V cheb.V \
	vpstyle=n size=r gridnum=2,2 >/dev/null out=$@

${RESDIR}/mig-impl.v: mod.H dat.H t2-fft.H Prod.x FFT.x Cosft.x \
		 T2.x cheb1-fft.H Impl.x Chebysh.x Cheb1.x
	<mod.H Grey title="Ideal image" >mod.V
	<dat.H Grey title="Input data" >dat.V
	<t2-fft.H  VCop.x vel=0.75 | Prod.x prod=t2-fft.H >out.H
	<out.H FFT.x sign1=-1 sign2=-1 | Real >real.H
	<real.H Window n1=400 n2=200 | T2.x inv=1 dens=2 >fft2.H
	<fft2.H Grey title="Fourier result" >fft.V
	<cheb1-fft.H Impl.x vel=0.75 nv=500 >out.H
	<out.H Cosft.x sign2=-1 | Window n2=200 | Chebysh.x inv=1 >real.H
	<real.H Cheb1.x inv=1 dens=2 | Window n1=200 >cheb.H
	<cheb.H Grey title="Chebyshev result" >cheb.V
	Vppen < mod.V dat.V fft.V cheb.V \
	vpstyle=n size=r gridnum=2,2 >/dev/null out=$@

${RESDIR}/fft-imp.v: spike.H T2.x FFT.x Prod.x VCop.x
	<spike.H T2.x | Rtoc | FFT.x sign1=1 sign2=1 > fft.H
	<fft.H VCop.x vel=1 | Prod.x prod=fft.H >out.H
	<out.H FFT.x sign1=-1 sign2=-1 | Real | T2.x inv=1 >imp1.H
	<fft.H VCop.x vel=-1 | Prod.x prod=fft.H >out.H
	<out.H FFT.x sign1=-1 sign2=-1 | Real | T2.x inv=1 >imp2.H
	<imp1.H Grey title="t^2-FFT impulse response, dv=1 km/s" >imp11.V
	<imp2.H Grey title="t^2-FFT impulse response, dv=-1 km/s" >imp12.V
	<spike.H T2.x |Pad n1out=512 n2out=512| Rtoc >pad.H
	<pad.H FFT.x sign1=1 sign2=1 > fft.H
	<fft.H VCop.x vel=1 | Prod.x prod=fft.H >out.H
	<out.H FFT.x sign1=-1 sign2=-1 | Real >real.H
	<real.H Window n1=256 n2=256| T2.x inv=1 >imp1.H
	<fft.H VCop.x vel=-1 | Prod.x prod=fft.H >out.H
	<out.H FFT.x sign1=-1 sign2=-1 | Real >real.H 
	<real.H Window n1=256 n2=256| T2.x inv=1 >imp2.H
	<imp1.H Grey title="t^2-FFT impulse response, dv=1 km/s" >imp21.V
	<imp2.H Grey title="t^2-FFT impulse response, dv=-1 km/s" >imp22.V
	Vppen < imp11.V imp12.V imp21.V imp22.V \
	vpstyle=n size=r gridnum=2,2 >/dev/null out=$@

${RESDIR}/cheb%-imp.v: Cheb%.x Chebysh.x Cosft.x Pseudo%.x  spike.H
	<spike.H Cheb$*.x | Chebysh.x | Pad n2out=257 | Cosft.x sign2=1 > fft.H
	<fft.H Pseudo$*.x vel=1 nv=3000 | Cosft.x sign2=-1 >out.H
	<out.H Chebysh.x inv=1 | Cheb$*.x inv=1 | Window n2=256 >imp1.H
	<fft.H Pseudo$*.x vel=-1 nv=3000 | Cosft.x sign2=-1 >out.H
	<out.H Chebysh.x inv=1 | Cheb$*.x inv=1 | Window n2=256 >imp2.H
	<imp1.H Grey title="Chebyshev impulse response, dv=1 km/s" >imp11.V
	<imp2.H Grey title="Chebyshev impulse response, dv=-1 km/s" >imp12.V
	<spike.H Cheb$*.x | Chebysh.x | Pad n2out=513 >pad.H
	<pad.H Cosft.x sign2=1 > fft.H
	<fft.H Pseudo$*.x vel=1 nv=3000 >out.H
	<out.H Cosft.x sign2=-1 | Window n2=256 >win.H
	<win.H Chebysh.x inv=1 | Cheb$*.x inv=1 >imp1.H
	<fft.H Pseudo$*.x vel=-1 nv=3000 >out.H
	<out.H Cosft.x sign2=-1 | Window n2=256 >win.H
	<win.H Chebysh.x inv=1 | Cheb$*.x inv=1 >imp2.H
	<imp1.H Grey title="Chebyshev impulse response, dv=1 km/s" >imp21.V
	<imp2.H Grey title="Chebyshev impulse response, dv=-1 km/s" >imp22.V
	Vppen < imp11.V imp12.V imp21.V imp22.V \
	vpstyle=n size=r gridnum=2,2 >/dev/null out=$@

Impl.x Impl.o: tricheb.o

${RESDIR}/cheb-impl.v: Cheb1.x Chebysh.x Cosft.x Impl.x  spike.H
	<spike.H Cheb1.x | Chebysh.x | Pad n2out=257 | Cosft.x sign2=1 > fft.H
	<fft.H Impl.x vel=1 nv=300 | Cosft.x sign2=-1 >out.H
	<out.H Chebysh.x inv=1 | Cheb1.x inv=1 | Window n2=256 >imp1.H
	<fft.H Impl.x vel=-1 nv=300 | Cosft.x sign2=-1 >out.H
	<out.H Chebysh.x inv=1 | Cheb1.x inv=1 | Window n2=256 >imp2.H
	<imp1.H Grey title="Chebyshev impulse response, dv=1 km/s" >imp11.V
	<imp2.H Grey title="Chebyshev impulse response, dv=-1 km/s" >imp12.V
	<spike.H Cheb1.x | Chebysh.x | Pad n2out=513 >pad.H
	<pad.H Cosft.x sign2=1 > fft.H
	<fft.H Impl.x vel=1 nv=300 >out.H
	<out.H Cosft.x sign2=-1 | Window n2=256 >win.H
	<win.H Chebysh.x inv=1 | Cheb1.x inv=1 >imp1.H
	<fft.H Impl.x vel=-1 nv=300 >out.H
	<out.H Cosft.x sign2=-1 | Window n2=256 >win.H
	<win.H Chebysh.x inv=1 | Cheb1.x inv=1 >imp2.H
	<imp1.H Grey title="Chebyshev impulse response, dv=1 km/s" >imp21.V
	<imp2.H Grey title="Chebyshev impulse response, dv=-1 km/s" >imp22.V
	Vppen < imp11.V imp12.V imp21.V imp22.V \
	vpstyle=n size=r gridnum=2,2 >/dev/null out=$@

${RESDIR}/fd-imp.v: spike.H Velcon.x
	<spike.H Pad n2out=500 > pad.H
	<pad.H Velcon.x vel=1 v0=0 nv=3000 inv=0 adj=1 |Window n2=256 >imp1.H
	<pad.H Velcon.x vel=1 v0=0 nv=3000 inv=1 adj=0 |Window n2=256 >imp2.H
	<imp1.H Grey title="Finite-diff impulse response, dv=1 km/s" >imp1.V
	<imp2.H Grey title="Finite-diff impulse response, dv=-1 km/s" >imp2.V
	Vppen < imp1.V imp2.V vpstyle=n size=r gridnum=2,1 >/dev/null out=$@

${RESDIR}/fft-inv.v: dat.H T2.x
	<dat.H T2.x |T2.x inv=1 >cod1.H
	<cod1.H Grey title="Reconstructed, grid=200" >cod1.V
	Add scale=1,-1 cod1.H dat.H >dif1.H
	<dif1.H Grey clip=0.579592 title="Difference, grid=200 " >dif1.V
	<dat.H T2.x dens=3 |T2.x inv=1 dens=3 >cod2.H
	<cod2.H Grey title="Reconstructed, grid=600" >cod2.V
	Add scale=1,-1 cod2.H dat.H >dif2.H
	<dif2.H Grey clip=0.579592 title="Difference, grid=600 " >dif2.V
	Vppen < cod1.V dif1.V cod2.V dif2.V \
	vpstyle=n size=r gridnum=2,2 >/dev/null out=$@

${RESDIR}/cheb%-inv.v: dat.H Cheb%.x
	<dat.H Cheb$*.x |Cheb$*.x inv=1 >cod1.H
	<cod1.H Grey title="Reconstructed, grid=200" >cod1.V
	Add scale=1,-1 cod1.H dat.H >dif1.H
	<dif1.H Grey clip=0.579592 title="Difference, grid=200 " >dif1.V
	<dat.H Cheb$*.x dens=3 |Cheb$*.x inv=1 dens=3 >cod2.H
	<cod2.H Grey title="Reconstructed, grid=600" >cod2.V
	Add scale=1,-1 cod2.H dat.H >dif2.H
	<dif2.H Grey clip=0.579592 title="Difference, grid=600 " >dif2.V
	Vppen < cod1.V dif1.V cod2.V dif2.V \
	vpstyle=n size=r gridnum=2,2 >/dev/null out=$@

FFT.x FFT.o: fft.o
Fun.x Fun.o: fft.o
Testcosft.x Testcosft.o: fft.o
Cosft.x Cosft.o: fft.o

Chebysh.x Chebysh.o: chebyshev.o fft.o
Testcheb.x Testcheb.o:  chebyshev.o fft.o
chebyshev.o: fft.o

Pseudo2.x Pseudo2.o: chebyshev.o fft.o
Pseudo1.x Pseudo1.o: chebyshev.o fft.o

Testtri.x Testtri.o: tricheb.o

FFT = FFT.x
data = /homes/sep/prof/bei/Data/alaska.H
raster = Byte pclip=100| Ta2vplot wheretitle=t wherexlabel=b titlesz=18 labelsz=12

${RESDIR}/plane.v : left.v rite.v
	vp_SideBySideAniso left.v rite.v > ${RESDIR}/plane.v

left.v: tx.v fx.v
	vp_OverUnderAniso tx.v fx.v > left.v

rite.v: tk.v fk.v
	vp_OverUnderAniso tk.v fk.v > rite.v

tx.v: FFT.x smo.H
	<smo.H Rtoc | ${FFT} sign1=0 sign2=0 |Real  >junk.H
	<junk.H ${raster} title="p(t,x)" label1="sec" label2="km" out=tx.v > tx.V

tk.v: FFT.x smo.H
	<smo.H Rtoc| ${FFT} sign1=0 sign2=1 |Real >junk.H
	<junk.H ${raster} title="P(t,k\s60 \_x\^\s100 )" label1="sec" label2="1/[km]" out=tk.v > tk.V

fx.v: FFT.x smo.H
	<smo.H Rtoc | ${FFT} sign1=1 sign2=0 |Real >junk.H
	<junk.H ${raster} title="P(\F10 w\F3 ,x)" label1="1/[sec]" label2="km" out=fx.v > fx.V

fk.v: FFT.x smo.H
	<smo.H Rtoc | ${FFT} sign1=1 sign2=1 |Real >junk.H
	<junk.H ${raster} title="P(\F10 w\F3 ,k\s60 \_x\^\s100 )" label1="1/[sec]" label2="1/[km]" out=fk.v > fk.V

smo.H:	${data}
	<${data} Smooth rect1=2 > smo.H

dothipass.x dothipass.o: dottest.o

clean : jclean

include ${SEPINC}/SEP.bottom

