from rsf.proj import *

Fetch('marmvel.hh','marm')

Flow('marmvel','marmvel.hh',
     '''
     dd form=native |
     put label1=Depth unit1=m label2=Distance unit2=m label=Velocity unit=m/s
     ''')

Result('velfig','marmvel',
       '''
       window j1=2 j2=4 |
       grey allpos=y bias=1500 color=j scalebar=y wanttitle=n
       bartype=h
       ''')

nt=2001
dt=0.0005

Flow('source',None,
     '''
     spike n1=%d d1=%g k1=100 | 
     ricker1 frequency=20
     '''%(nt,dt))

Flow('vel','marmvel','window n1=1 | spray axis=1 n=751 | cat axis=1 $SOURCE | smooth rect1=3 rect2=3')

Flow('fft','vel','fft1 | fft3 axis=2 pad=1')

Flow('mid left right','vel fft',
     'isolr2 seed=2011 npk=30 eps=0.00001 dt=%g fft=${SOURCES[1]} left=${TARGETS[1]} right=${TARGETS[2]}' % dt)

for s in (5500,6500):
    source = 'source%d' % s
    Flow(source,None,'spike n1=1502 n2=2301 d1=4 d2=4 k1=751 k2=%d | smooth rect1=3 rect2=3 repeat=3' % (s/4))

    wave = 'wave%d' % s
    Flow(wave,['source',source,'left','mid','right'],
         '''
         fftwave2 ref=${SOURCES[1]} left=${SOURCES[2]} mid=${SOURCES[3]} right=${SOURCES[4]} verb=y
         ''')

End()
