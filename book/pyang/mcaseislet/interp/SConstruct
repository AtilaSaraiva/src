from rsf.proj import *

Fetch('sean.HH','bp')

def grey(title):
    return 'grey title="%s" label2=Channel label1="Time (s)" ' % title

Flow('sean','sean.HH',
     'dd form=native | window n3=1 f3=3 n1=500 | bandpass fhi=50')
Plot('sean',grey('Original')) 
Result('sean',grey('Original')) 
     
# Pad to a power of 2
Flow('sean1','sean','pad n2=256')

# Randomly remove 30% of traces
Flow('mask','sean',
     '''
     window n1=1 | noise type=n seed=2014 rep=y mean=0.5 |
     mask max=0.7 | pad n1=256 |
     spray axis=1 n=500 | dd type=float
     ''')
Flow('sean2','sean1 mask','mul ${SOURCES[1]}')
Plot('sean2','window n2=180 | grey title=Missing')

#================================================================================
Flow('ppq','sean2 mask','twodip2 mask=${SOURCES[1]} order=2 eps=5 verb=y gauss=n niter=10 | pad n2=256')
Flow('dip1','ppq','window n3=1')
Flow('dip2','ppq','window f3=1')
Plot('dip1','window n2=180 |%s pclip=100 scalebar=y color=j' % grey('First Dip'))
Plot('dip2','window n2=180 |%s pclip=100 scalebar=y color=j' % grey('Second Dip'))
Result('dips','dip1 dip2','SideBySideIso')

# Seislet-based MCA inpainting 1st:
Flow('rec1 rec2','sean2 dip1 dip2 mask',
     '''
     mcaseislet dip1=${SOURCES[1]} dip2=${SOURCES[2]} mask=${SOURCES[3]}
     comp2=${TARGETS[1]} verb=y order=2 type=b eps=0.01 niter=10 pclip=3 pscale=50 
     ''')
# ... smth1=y smth2=y rect1=2 rect2=4

#===============================================================================
#Flow('ddip1', 'rec1','dip rect1=5 rect2=5 order=2')
#Flow('ddip2', 'rec2','dip rect1=5 rect2=5 order=2')
#Plot('ddip1','window n2=180 |%s pclip=100 scalebar=y color=j' % grey('First Dip'))
#Plot('ddip2','window n2=180 |%s pclip=100 scalebar=y color=j' % grey('Second Dip'))
#Result('ddips','ddip1 ddip2','SideBySideIso')


Flow('rec','rec1 rec2','add scale=1,1 ${SOURCES[1]}')
Flow('pq','rec','window n2=180 | pad n2=256 | twodip2 order=2 eps=5 verb=y gauss=n niter=10')
Flow('ddip1','pq','window n3=1')
Flow('ddip2','pq','window f3=1')
Plot('ddip1','window n2=180 |%s pclip=100 scalebar=y color=j' % grey('First Dip'))
Plot('ddip2','window n2=180 |%s pclip=100 scalebar=y color=j' % grey('Second Dip'))
Result('ddips','ddip1 ddip2','SideBySideIso')

# Seislet-based MCA inpainting 2nd:
Flow('rrec1 rrec2','sean2 ddip1 ddip2 mask',
     	'''
     	mcaseislet dip1=${SOURCES[1]} dip2=${SOURCES[2]} mask=${SOURCES[3]}
    	comp2=${TARGETS[1]} verb=y order=2 type=b eps=0.01 niter=10 pclip=3 pscale=50 
     	''')

#==============================================================================
Flow('rrec','rrec1 rrec2','add scale=1,1 ${SOURCES[1]}')
Plot('rrec1','window n2=180 | grey title=rec1')
Plot('rrec2','window n2=180 | grey title=rec2')
Plot('rrec','window n2=180 | grey title=rec1+rec2')

Result('rec','sean sean2 rrec1 rrec2 rrec','SideBySideAniso')

#
End()

