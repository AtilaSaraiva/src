from rsf.proj import *

#SConscript('../fetch/SConstruct')

Flow(['gather_subset.rsf','gather_subset_hdr.rsf'],
     ['../fetch/npr3_gathers.rsf','../fetch/npr3_gathers_hdr.rsf'],
     '''
     sftahsort 
  	input=$SOURCE 
	sort="iline:169,181  xline:104,116 offset:0,11000" 
        verbose=1  
     | sftahmakeskey pkey=iline,xline skey=cdpt verbose=1 
     | sftahwrite 
        verbose=1                           
	label2="cdpt"  o2=1 n2=34  d2=1   
        label3="xline" o3=104 n3=13 d3=1   
        label4="iline" o4=169 n4=13  d4=1   
        output=$TARGET
     ''',stdout=0,stdin=0)
Plot('gather_subset','grey title="gather_subset"',view=1)
Plot('zoomgather_subset','gather_subset',
     'sfwindow max1=2. | grey title="gather_subset_zoom"',view=1)

# Doing it without tah
Flow('iline','../fetch/npr3_gathers_hdr.rsf',
     'window n1=1 f1=73 | mask min=169 max=181')
Flow('xline','../fetch/npr3_gathers_hdr.rsf',
     'window n1=1 f1=74 | mask min=104 max=116')
Flow('offset','../fetch/npr3_gathers_hdr.rsf',
     'window n1=1 f1=11 | mask min=0 max=11000')
Flow('mask','iline xline offset','mul ${SOURCES[1:3]}')

Flow('window','../fetch/npr3_gathers.rsf mask',
     'headerwindow mask=${SOURCES[1]}')
Flow('window_hdr','../fetch/npr3_gathers_hdr.rsf mask',
     'headerwindow mask=${SOURCES[1]}')

Flow('gather','window window_hdr','intbin3 head=${SOURCES[1]} xkey=-1')

Plot('gather','grey title="gather_subset"',view=1)
Plot('zoomgather','gather',
     'sfwindow max1=2. | grey title="gather_subset_zoom"',view=1)

Result('gather',
       '''
       put n4=1 o3=1 n3=169 | 
       byte | grey3 frame1=1000 frame2=7 frame3=7 
       title=Gathers label2=Trace label3=CDP
       ''')

End()
