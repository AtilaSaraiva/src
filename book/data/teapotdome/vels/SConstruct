from rsf.proj import *

Flow(['tteapot','teapot.asc','teapot.bin'],None,
     '''
     segyread tfile=${TARGETS[0]} hfile=${TARGETS[1]} bfile=${TARGETS[2]} tape=npr3_field.sgy |
     window n2=1
     ''',stdin=0,stdout=0)

# Xline/Inline coordinates
Flow('ixc','tteapot','dd type=float | headermath output="xline"')
Flow('ilc','tteapot','dd type=float | headermath output="iline"')
Flow('ixil',['ixc','ilc'],'cmplx ${SOURCES[1]}')

# Make survey mask out of existing CDP locations
Flow('surveymask.dat',['ixil','surveymask.py'],'''
     disfil col=1 number=n | /usr/bin/python ${SOURCES[1]}
     ''')

# Interpolate velocities from t-v ASCII pairs
Flow(['vvol','vvol.dat'],['npr3_dmo.vel','interpvel.py','surveymask.dat'],'''
     /usr/bin/python ${SOURCES[1]} ${SOURCES[2]}
     ''')

xline=120
minclip=8800
maxclip=20000

Result('vel_xline%d' % xline,'vvol','''
       window min2=%d max2=%d | clip2 lower=%d upper=%d |
       grey color=j scalebar=y allpos=y pclip=100 bias=%d
            title="Velocity at xline %d" label1=Time unit1=ms label2=Inline unit2=
       ''' % (xline, xline, minclip, maxclip, minclip, xline))

time=300

Result('vel_time%d' % time,'vvol','''
       window min1=%d max1=%d | clip2 lower=%d upper=%d |
       grey color=j scalebar=y allpos=y pclip=100 bias=%d
            title="Velocity at time %d" label1=xline unit1= label2=xline unit2=
       ''' % (time, time, minclip, maxclip, minclip, time))
End()

