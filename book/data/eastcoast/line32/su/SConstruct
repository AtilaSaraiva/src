from rsf.suproj import * 

#http://woodshole.er.usgs.gov/operations/ia/public_ds_info.php?fa=1978-015-FA
#http://cotuit.er.usgs.gov/Data/1978-015-FA/NL/001/01/32-obslogs/32obslog.pdf   #http://cotuit.er.usgs.gov/Data/1978-015-FA/SE/001/18/
#################### 
# Fetch the dataset and convert to multiple rsf files
# check web at
# http://energy.usgs.gov/GeochemistryGeophysics/\
# SeismicDataProcessingInterpretation/\
# NPRASeismicDataArchive/tabid/494/\
# Agg2146_SelectTab/4/Default.aspx
####################

# first download the display of the previous stack
# download and view the image of the previous stack:
#Fetch('41_81_IM.JPG',
#      server='http://certmapper.cr.usgs.gov',
#      top='nersl/NPRA/SEISMIC/1981/41_81',
#      dir='IMAGES')
#THis can be done using:
# wget http://certmapper.cr.usgs.gov/nersl/NPRA/SEISMIC/1981/41_81/IMAGES/41_81_IM.JPG 
#Result('prevstack','41_81_IM.JPG',
#       'oodraw ${SOURCES[0]}',stdin=0)

# download and view the survey notes:
#Fetch('41_81_S.PDF',
#      server='http://certmapper.cr.usgs.gov',
#      top='nersl/NPRA/SEISMIC/1981/41_81',
#      dir='DOCUMENTS')
#Result('surveylog','41_81_S.PDF',
#       'acroread ${SOURCES[0]}',stdin=0)

# download and view the observer notes:
Fetch('32obslog.pdf',
      server='http://cotuit.er.usgs.gov',
      top='Data/1978-015-FA/NL/001/01',
      dir='32-obslogs')
Result('observerlog','../fetch/32obslog.pdf',
       'acroread ${SOURCES[0]}',stdin=0)

# i added suwind to padd all traces to the same time length
segyread = '''
segyread bfile=${TARGETS[1]} hfile=${TARGETS[2]}
tape=$SOURCE endian=%d
| segyclean
| suwind tmax=12
''' % (1-little_endian())

rawsegy=['U32A_01','U32A_02','U32A_03','U32A_04','U32A_05',
         'U32A_06','U32A_07','U32A_08','U32A_09','U32A_10',
         'U32A_11','U32A_12','U32A_13','U32A_14','U32A_15',
         'U32A_16','U32A_17','U32A_18','U32A_19','U32A_20',
	 'U32A_21']
# to test just use 2 files
#rawsegy=['U32A_15','U32A_16']
#rawsegy=['U32A_01','U32A_02','U32A_03','U32A_04','U32A_05',
#         'U32A_06','U32A_07','U32A_08','U32A_09','U32A_10',
#         'U32A_11']
# there are also 'U32B_01','U32B_02','U32B_03'
# and  'U32C_01','U32C_02','U32C_03'
# and 'U32_01'
# I think the line is collected in 3 parts. 32, 32a, and 32b
for file in rawsegy  :
    Flow([file, file+'.bin',  file+'.asc'],
         '../fetch/'+file+'.SGY',segyread,stdin=0)
    Flow(file+'_list1',file,'surange; echo file_list1 complete',stdout=0)
#         file+'.SGY',segyread,stdin=0)

# concatinate the input files
Flow ('line', rawsegy,
     'cat ${SOURCES}',stdin=0)

# you can make this list with the command scons list1.su
Flow('list1','line','surange; echo list1 complete',stdout=0)

# you can make this list with the command scons list2.su
Flow('list2','line',
     '''
     suwind count=3000 
     | sugethw key=fldr,tracf,cdp,cdpt,offset ;
     echo list2 complete
     ''',
     stdout=0)

# display the first 3000 traces

Result('first','line',
       'suwind count=3000 | suximage perc=90')

Result('zoomfirst','line',
       '''
       suwind key=tracl min=48141 max=48300 tmin=0 tmax=3 |
       suximage perc=90
       ''')

Result('firstmovie','line',
       '''
       suxmovie n2=48 loop=1 fframe=1 dframe=1 
                title="record %g" perc=20 
       ''')

Result('firstrec24','line',
       '''
       suwind key=tracl min=48141 max=48300 tmin=0 tmax=6 |
       suximage perc=90
       ''')

Flow('ntg','line',
       'suwind key=tracf min=48 max=48')

Result('ntg','ntg',
       'suximage perc=90')



Flow ('hdrfile.txt','line',
     'sugethw output=geom key=tracl,fldr,tracf')
 
Flow ('hdrfile1.txt',
      'hdrfile.txt InterpText.py spnElev.txt recnoSpn.txt',
     ''' 
     ./InterpText.py
     ''',stdin=0)

Flow ('binary_hdrfile1.dat','hdrfile1.txt',
     ''' 
     a2b n1=13
     ''')

keys='ep,sx,sy,gx,gy,cdp,tracf,offset,' \
      'selev,gelev,sstat,gstat,tstat'

Flow ('allshots', 'line binary_hdrfile1.dat',
     '''
     sushw 
     	   infile=${SOURCES[1]}
    	   key=%s |
     sushw 
     	   key=f1 
    	   a=0 |
     suwind 
     	    key=cdp 
    	    min=-999998 
    	    max=999999 |
     suwind 
     	    key=ep 
    	    min=-999998 
    	    max=999999 |
     suwind 
     	    key=ep 
	    reject=149
    ''' % keys)

#Result('test','allshots',
#	'''
#	 suxmovie n2=96 loop=1 fframe=1 dframe=1 
#            title="allshots record %g" perc=20
# 	''')

	
# download, convert, and view previous processing stack
Fetch('CSDS32_1.SGY',
      server='http://cotuit.er.usgs.gov',
      top='Data/1978-015-FA/SE/001',
      dir='39')
file='checkstack'
Flow([file, file+'.bin', file+'.asc'],
     'CSDS32_1.SGY',segyread,
     stdin=0)

Result('checkstack','checkstack',
       'suximage title="checkstack" perc=90')
Result('zoomcheckstack','checkstack',
       '''
       suwind tmin=0 tmax=3  |
       suximage title="zoom checkstack" perc=90
       ''')

End()
