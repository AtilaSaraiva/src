from rsfproj import *

#############################################
#
# . . SETUP FOR PLUTO MODEL 
#
SCR = '/scr1/jeff/'
PDIR = '/mnt/sepdata/1a/pluto/'
Cartpar = 'a1n=810 a1d=37.5 a1o=0. a2n=6400 a2o=-30000 a2d=37.5' 
dn='>\dev\\null'
weipar= 'min5=3 max5=32.5 j5=2 squeeze=n'
bppar ='flo=1.0 fhi=35.'
weipar2= 'min5=3 max5=32.5 j5=2 squeeze=n'

B = './Bin/'
#########################################3
#
# . . Velocity
#
Flow('Pvel',None,
     '''
     spike n1=500 n2=1024 d1=10. d2=10. o1=0. o2=0. nsp=0 | math output='input+2000.' 
     ''')

for axis in ('x2','x1'):
    Flow(axis,None,
         'math n1=500 d1=10. o1=0. n2=1024 o2=0. d2=10. output='+axis)

Flow('Rays','x2 x1',
     '''
     cat axis=3 space=n ${SOURCES[1]}
     ''')

Flow('Cvel','Pvel Rays',
     '''
     c2r adj=n rays=${SOURCES[1]} 
     ''' )

## Result('Pvel',
##        '''
##        grey color=j newclip=1 epclip=100 bpclip=0 scalebar=y
##        ''')
## Result('Cvel',
##        '''
##        grey color=j newclip=1 epclip=100 bpclip=0 scalebar=y
##        ''')

#########################################3
#
# . . DATA
#

## . . Source data
Flow('Sdata',None,
     '''
     spike n1=2048 n2=1024 n3=1 d1=0.004 d2=10 d3=1 o1=-0.02 o2=0.
     o3=0. nsp=1 k1=13 k2=412 k3=1 | bandpass fhi=45 | fft1 | transp plane=12 | window min2=3 max2=25 j2=2
     ''' )

## . . Receiver Data
Flow('Rdata',None,
     '''
     spike n1=2048 n2=1024 n3=1 d1=0.004 d2=10 d3=1 o1=-0.02 o2=0.
     o3=0. nsp=3 k1=50,200,350 k2=612,612,612 k3=1,1,1 | bandpass fhi=45 |
     fft1 | transp plane=12 | window min2=3 max2=25 j2=2
     ''')   


#########################################
#
# . . Single-shot Migration
#

Flow('Mig RMig','Rdata Sdata Cvel Rays',
     '''
     rwe2d rwf=${SOURCES[0]} swf=${SOURCES[1]} vel=${SOURCES[2]} rays=${SOURCES[3]}
     image=${TARGETS[0]} Rimage=${TARGETS[1]}  nref=36 verbose=1 
     min_region_pct=1 del_dist=1 verb=0 niter_lloyd=40 ntap=25 nloop=3 norm=1 nsx=2 nsz=2
     ''',stdin=0,stdout=0) 

Result('Mig','Mig Cvel',
     '''
     cat Mig.rsf Cvel.rsf axis=3 space=n | grey gainpanel=e pclip=100  
     ''' ) 


End() 
 
