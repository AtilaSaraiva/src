from rsfproj import *
import sys, math
sys.path.append('../../Scons')
import zomig,sgmig

# ------------------------------------------------------------
# PLOTTING
# ------------------------------------------------------------
def igrey(custom):
    return '''
    grey  labelrot=n wantaxis=y wanttitle=y title=""
    pclip=100
    min2=-500 max2=500 grid=y gridcol=0
    label1="z (m)" label2="x (m)"
    %s 
    ''' % (custom)
# ------------------------------------------------------------
par = {
    'nz':200,  'dz':5.0,  'oz':0,
    'nx':600,  'dx':5.0,  'ox':-1500,
    'nt':1000, 'dt':0.004,'ot':0, 'kt':201,
#
    'nw':256, 'ow':1.0, 'jw':10, 'dw':0.05,
    'nw':30, 'ow':2.0, 'jw':3,
    'nw':1,  'ow':20.0,
#    'nw':20, 'ow':2.0, 'jw':10,
#    
    'verb':'n','eps':0.01,'nrmax':1,'dtmax':0.00005,
    'tmx':32,'tmy':0,'pmx':32,'pmy':0,
    'misc':'incore=n',
#
    'nsc':1
    }
par['zmin']=par['oz']
par['zmax']=par['oz'] + (par['nz']-1) * par['dz']
par['xmin']=par['ox']
par['xmax']=par['ox'] + (par['nx']-1) * par['dx']

# ------------------------------------------------------------
# DATA
# ------------------------------------------------------------
Flow('dat',None,
     '''
     spike nsp=1 mag=1 
     n1=%(nt)d d1=%(dt)g o1=0      k1=200
     n2=%(nx)d d2=%(dx)g o2=%(ox)g k2=300 l2=300 |
     smooth rect2=3 | 
     ricker1 frequency=10 |
     put label1=t label2=x label3=y 
     ''' % par )    
Result('dat','dat',igrey('title="data"'))
zomig.wflds('wfl','dat',par)

# ------------------------------------------------------------
# VELOCITY/SLOWNESS
# ------------------------------------------------------------
Flow('vel',None,
     '''
     spike nsp=1 mag=2000
     n1=%(nz)d d1=%(dz)g o1=0 |
     spray axis=2 n=%(nx)d o=%(ox)g d=%(dx)g |
     put label1=z label2=x label3=y 
     ''' % par )    
Result('vel','vel',igrey('title="background velocity"'))
Flow('slo','vel',
     '''
     transp |
     math "output=1/input" |
     spray axis=2 n=1 |
     put label2=y
     ''' % par )

Flow('dsl',None,
     '''
     spike nsp=1 mag=0.00005,0.0002,0.0001
     n1=%(nz)d d1=%(dz)g o1=%(oz)g k1=079,089,099 l1=081,091,101
     n2=%(nx)d d2=%(dx)g o2=%(ox)g k2=299,249,349 l2=301,251,351 |
     put label1=z label2=x label3=y |
     smooth rect1=1 rect2=1 |
     transp plane=12 |
     transp plane=23 |
     rtoc
     ''' % par )
# k1=079,089,099 l1=081,091,101
# k2=299,249,349 l2=301,251,351

# ------------------------------------------------------------
# IMAGE
# ------------------------------------------------------------
zomig.image('img','slo','wfl',par)
Result('img','img','window | transp |' + igrey('title="image"'))

# ------------------------------------------------------------
# WAVEFIELD
# ------------------------------------------------------------
zomig.Awftwo('www','wfl','slo',par)

# ------------------------------------------------------------
# forward WEMVA
# ------------------------------------------------------------

zomig.s2i('dsl','dim','www','slo',par)
zomig.i2s('dim','bsl','www','slo',par)

Plot('www','www','window | real | transp |'+ igrey('title="www"'))
Plot('dim','dim','window | real | transp |'+ igrey('title="dim"'))
Plot('img','img','window |        transp |'+ igrey('title="img"'))

Plot('dsl','dsl','window | real | transp |'+ igrey('title="dsl" color=F'))
Plot('bsl','bsl','window | real | transp |'+ igrey('title="bsl" color=F'))

def combine2by2(plot,p0,p1,p2,p3):
    j0 = '_' + p0
    j1 = '_' + p1
    j2 = '_' + p2
    j3 = '_' + p3

    Plot(j0,p0,'Overlay',vppen='yscale=0.5 xscale=0.40 ycenter=-10.0 xcenter=-00.0')
    Plot(j1,p1,'Overlay',vppen='yscale=0.5 xscale=0.40 ycenter=-10.0 xcenter=-15.0')
    Plot(j2,p2,'Overlay',vppen='yscale=0.5 xscale=0.40 ycenter=-00.0 xcenter=-00.0')
    Plot(j3,p3,'Overlay',vppen='yscale=0.5 xscale=0.40 ycenter=-00.0 xcenter=-15.0')

    Result(plot,[j0,j1,j2,j3],'Overlay')

combine2by2('scat','img','dsl','dim','bsl')

# ------------------------------------------------------------

for i in range(5):
    par['nsc']=i

    dim = 'dim' + str(i)
    zomig.s2i('dsl',dim,'www','slo',par)
    Plot(dim,dim,'window | real | transp |'+ igrey('title="%s"' % i))

    bsl = 'bsl' + str(i)
    zomig.i2s(dim,bsl,'www','slo',par)
    Plot(bsl,bsl,'window | real | transp |'+ igrey('title="%s" color=F' % i))


Result('dimall','dim0 dim1 dim2 dim3 dim4','Movie')
Result('bslall','bsl0 bsl1 bsl2 bsl3 bsl4','Movie')

End()
