from rsfproj import *
import zomig

Fetch('beistk.rsf','masha')
Flow('stk','beistk.rsf','dd form=native')

Fetch('beivxz.dat','masha')
Flow('vxz','beivxz.dat',
     '''
     echo in=$SOURCE
     n1=250 o1=0 d1=0.0332
     n2=250 o2=0 d2=0.0161
     label1=Lateral unit1=km
     label2=Depth unit2=km
     label=Velocity unit="km/s"
     data_format=ascii_float |
     dd form=native |
     transp |
     window max1=3.2
     ''',stdin=0)

for coord in ('x','z'):
    dat = 'bei%s.dat' % coord
    Fetch(dat,'masha')
    Flow(coord,dat,
         '''
         echo in=$SOURCE
         n2=751 n1=250
         data_format=ascii_float |
         dd form=native 
         ''',stdin=0)

xmax = 8.2668
zmax = 3.2039

Plot('vxz',
     '''
     grey color=j scalebar=y allpos=y bias=1.4 barreverse=y
     title="Estimated Interval Velocity" barlabel= barunit=
     screenht=%g screenwd=%g bartype=v 
     ''' % (1.8*zmax,1.8*xmax))

Plot('rays','x z',
     '''
     cmplx ${SOURCES[:2]} | transp | window j2=5 |
     graph wanttitle=n yreverse=y min1=0 max1=%g min2=0 max2=%g
     plotcol=7 scalebar=y wantaxis=n screenht=%g screenwd=%g bartype=v
     ''' % (xmax,zmax,1.8*zmax,1.8*xmax),stdin=0)

Result('beivxz','vxz rays','Overlay')

Result('beistk','stk',
       '''
       grey title=Stack
       label1=Time unit1=s label2=Lateral unit2=km
       ''')

par = {
    'nx':250,'ox':0,'dx':0.0335,
    'nt':1000,'ot':0,'dt':0.004,
    'nz':250,'oz':0,'dz':0.0161,
    #
    'nw':501, 'ow':0, 'dw':0.25,'jw':1,
    #
    'verb':'y','eps':0.01,'nrmax':5
    }

Flow('slo','vxz',
     '''
     transp plane=12 |
     transp plane=23 |
     math "output=1/input" |
     put label1=x label2=y label3=z
     ''')

zomig.wflds ('dat','stk',par)
zomig.image('img','slo','dat',par)

Result('beiimg','img',
       '''
       window |
       transp |
       grey title="Post-Stack Depth Migration"
       label1=Depth unit1=km label2=Lateral unit2=km
       ''')

End()
