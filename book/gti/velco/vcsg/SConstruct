from rsfproj import *

Flow('flat',None,'spike n1=6001 o1=-3 d1=0.001')

Flow('modl','flat',
     '''
     kirmod ns=1 s0=0 nh=601 dh=0.01 h0=-3
     vel=1 freq=10 nt=1000 dt=0.004 
     ''')

Result('modl',
       'grey title="Shot Gather" label1=Time unit1=s label2=Offset unit2=km')

fft = 'fft1 | window max1=30'

Flow('wav',None,'spike n1=1000 k1=1 | ' + fft)
Flow('rwfl swfl','modl wav',
     fft + ''' |
     spray axis=3 n=1 o=0 d=1 |
     spray axis=5 n=1 o=0 d=1 |
     srsyn nx=500 dx=0.01 ox=-2.5 wav=${SOURCES[1]} swf=swf.rsf |
     transp plane=12 | transp plane=23 > ${TARGETS[0]} &&
     transp plane=12 < swf.rsf | transp plane=23 > ${TARGETS[1]} &&
     rm swf.rsf
     ''',stdout=-1)

for case in (90,100,110):    
    slow = 'slow%d' % case
    Flow(slow,None,
         '''
         spike mag=%g
         n3=201 d3=0.01 o3=0 n2=1 d2=0.01 o2=0 n1=601 d1=0.01 o1=-3
         ''' % (100.0/case))

    imag = 'imag%d' % case
    Flow(imag,['swfl','rwfl',slow],
         'srmig2 slo=${SOURCES[2]} rwf=${SOURCES[1]} readwrite=y verb=y')
    Plot(imag,
         '''
         window | grey pclip=100 
         title="Image  (Velocity=%d%%)" transp=n
         label2=Depth unit2=km
         label1=Lateral unit1=km
         ''' % case)

    theor = 'theor%d' % case
    v = case/100.0
    v2 = v*v
    Plot(theor,slow,
         '''
         window n3=1 |
         math output="sqrt(%g+%g*x1*x1)" |
         graph min2=0 max2=2 yreverse=y
         ''' % (v2,(1./v2-1.)))

    Result(imag,[imag,theor],'Overlay')

End()
