from rsfproj import *

private = {'login':os.environ.get('BEG_LOGIN'),
           'password':os.environ.get('BEG_PASSWORD'),
           'server':os.environ.get('BEG_SERVER')}

for par in ('vel','delta','eps'):
    mod = 'gx_%s_sm_50m.HH' % par
    Fetch(mod,'xom',private)
    Flow(par,mod,'dd form=native')

    # 2-D slice
    Flow(par+'2',par,'window n3=1 f3=161 min2=11500')

def grey(bias,title,label):
    return '''
    grey color=j bias=%d scalebar=y title="%s"
    label1=Depth label2=Surface unit1=m unit2=m 
    barlabel="%s" barunit=m/s screenratio=0.7857
    ''' % (bias,title,label)

Plot('vel2',grey(3000,'Vertical Velocity','v\s60 \_z'))
Result('vel2','Overlay')

Flow('eta2','delta2 eps2',
     '''
     math del=${SOURCES[0]} eps=${SOURCES[1]}
     output="(eps-del)/(1+2*del)"
     ''')

Result('eta2',grey(0,'Anellpticity','\F10 h\F3'))

Flow('vx2','vel2 eps2','math eps=${SOURCES[1]} output="input*sqrt(1+2*eps)" ')

Result('vx2',grey(3000,'Horizontal Velocity','v\s60 \_x'))

def graph(case):
    return '''
    graph screenratio=0.7857
    min2=11500 max2=19150 scalebar=y 
    min1=0 max1=6000 wanttitle=n wantaxis=n
    plotcol=7 transp=1 yreverse=y dash=%d plotfat=3
    ''' % (case=='a')

for case in ('','a'):
    rays2 = 'rays2'+case
    fronts2 = 'fronts2'+case

    Flow(rays2,'vel2 vx2 eta2',rays2 + '''
    vx=${SOURCES[1]} eta=${SOURCES[2]} nr=1000 nt=4000 dt=0.001 yshot=15000
    ''')

    Plot(rays2,'window j2=5 |' + graph(case))
    Plot(fronts2,rays2,'window j1=100 | transp |' + graph(case))

Result('rays2','vel2 rays2 rays2a','Overlay')
Result('fronts2','vel2 fronts2 fronts2a','Overlay')

End()
