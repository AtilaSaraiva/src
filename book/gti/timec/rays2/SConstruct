from rsfproj import *
import math

###########################################################################

def symes(nx,nz):
    return '''
    spike n1=%d n2=%d d1=%g d2=%g label1=' ' label2=' ' |
    math output="1+0.2*sin(%g*x2)*sin(%g*x1)"
    ''' % (nz,nx,2./(nz-1),1./(nx-1),3*math.pi,0.5*math.pi)

Flow('symes',None,symes(100,200))

Plot('symes','''
grey color=j bias=1 pclip=100 scalebar=n wanttitle=n screenratio=2''')

graph = '''
graph
min2=0 max2=1
min1=0 max1=2
plotcol=7 transp=1
wantaxis=n wheretitle=b whersexlabel=t
yreverse=y screenratio=2
title="Ray tracing"
'''

par = ' nr=1000 nt=4000 dt=0.001 yshot=0.6'

Flow('syrays2','symes','rays2' + par)
Plot('syrays2','window j2=5 |' + graph)
Plot('syfronts2','syrays2','window j1=100 | transp |' + graph)

Result('syrays2','symes syrays2','Overlay')
Result('syfronts2','symes syfronts2','Overlay')

Plot('sycell2','symes',
     '''cell2 %s |
     plotrays frame=$SOURCE screenratio=2 jr=5 plotcol=7''' % par)
Result('sycell2','symes sycell2','Overlay')

Flow('sytable','symes',
     'shoot2 %s zshot=1 nr=40 r0=0.2 dr=0.02' % par)
Plot('syshoot2',['symes','sytable'],          
     '''cell2 %s zshot=1 anglefile=${SOURCES[1]} |
     plotrays frame=${SOURCES[0]} screenratio=2 plotcol=7''' % par)
Result('syshoot2','symes syshoot2','Overlay')

############################################################################

End()
