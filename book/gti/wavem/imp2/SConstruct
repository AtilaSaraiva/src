from rsfproj import *

Flow('impuls',None,
     '''
     spike n1=4000 n2=401 d1=0.001 d2=0.01 
     nsp=4 k1=400,800,1200,1600 k2=201 |
     bandpass flo=2 fhi=40 |
     fft1 |
     transp | spray axis=2 n=1 d=0.01 |
     window max3=40 squeeze=n |
     put label1=x label2=y label3=w
     ''')

Flow('impuls2',None,
     '''
     spike n1=4000 n2=401 n3=101 d1=0.001 d2=0.01 d3=0.01 
     nsp=4 k1=400,800,1200,1600 k2=200 k3=50 |
     bandpass flo=2 fhi=40 |
     fft1 |
     transp plane=13 | 
     window max3=40 |
     put label1=h label2=y label3=w
     ''')

Flow('const',None,
     '''
     spike n3=151 n1=401 n2=1 d3=0.01 d1=0.01 d2=0.01 mag=%g
     ''' % (1.0/1.5))

Flow('zof','impuls const',
     'sstep2 slowness=${SOURCES[1]} verb=y readwrite=y nt=25')
Flow('cof','impuls2 const',
     'dsr2 slowness=${SOURCES[1]} verb=y readwrite=y nt=25')

#Result('pzof','zof','window | transp | grey title="2-D Impulse Responses" ')

# ------------------------------------------------------------
# common-azimuth

CAM='camig readwrite=y verb=y inv=n eps=0.1 tmx=25 tmy=25 nr=1 dt=0.016 pmx=0 pmy=0 phx=0'

# 2-D
Flow('slo-c2d','const',
     '''
      put label1=x label2=y label3=z
     ''')
Flow('dat-c2d','impuls',
     '''
     window squeeze=n |
     spray axis=2 n=1 |
     put label2=y label3=h
     ''')
Flow('img-c2d','dat-c2d slo-c2d','%s slo=${SOURCES[1]}' % CAM )
Result('pimg-c2d','img-c2d',
       '''
       window | transp plane=12 |
       grey pclip=100 title="2-D Impulse Responses (CAM)"
       ''')

# 3-D
Flow('slo-c3d','const',
     '''
     window |
     spray axis=2 n=401 o=0 d=0.01 |
     put label1=x label2=y label3=z |
     window squeeze=n j1=4 j2=4 j4=4 
     ''')
Flow('dat-c3d','dat-c2d',
     '''
     pad beg2=200 n2out=401 |
     put o2=0 d2=0.01 |
     window squeeze=n j1=4 j2=4
     ''')
Flow('img-c3d','dat-c3d const','%s slo=${SOURCES[1]}' % CAM )
Result('pimg-c3d','img-c3d',
       '''
       window | transp plane=23 | transp plane=12 |
       byte gainpanel=a pclip=100 |
       grey3 flat=y frame1=50 frame2=51 frame3=51 title="3-D Impulse Responses (CAM)"
       ''')

End()
