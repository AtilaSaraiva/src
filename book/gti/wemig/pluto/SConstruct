from rsfproj import *
import sys
sys.path.append('../../Scons')
import wemig

# ------------------------------------------------------------
# MIGRATION parameters
# ------------------------------------------------------------
par = {
    'nw':250, 'ow':1,'jw':1,
    'nw': 1,  'ow':5,
    'nx':650, 'ox':0, 'dx':0.150,
    'ns':330, 'js':2,'fs':10,
    'ns':35,  'js':20,'fs':10,
    'nh':400,
    #
    'verb':'y',
    'eps':0.01,
    'nrmax':5,
    'dtmax':0.00005,
    'tmx':16, 'tmy':0,
    'pmx':0,  'pmy':0,
    #
    'xmin':0, 'xmax':97.5, 'zmin':1.75, 'zmax':35
    }

wpar = {'nt':1126,'ot':0, 'dt':0.008, 'kt':1,'ft':0}
# ------------------------------------------------------------
# fetch data
# ------------------------------------------------------------
Fetch(['pluto.velo.hh'],'pluto')
Fetch(['pluto.shot.hh'],'pluto')

# ------------------------------------------------------------
# VELOCITY
# ------------------------------------------------------------
Flow('velo','pluto.velo.hh',
     '''
     dd form=native |
     put label1=z d1=0.025 o1=0
         label2=x d2=0.025 o2=-34.875 |
     math "output=input/1000"
     ''')

Flow('s0','velo',
     '''
     math "output=1/input" |
     transp |
     spray axis=2 n=1 o=0 d=1 |
     put label2=y
     ''')
Flow('sd','s0','window squeeze=n j3=70 n3=1')
Flow('s1','s0','window squeeze=n f3=70')

# ------------------------------------------------------------
# SHOTS
# ------------------------------------------------------------
Flow('sraw','pluto.shot.hh',
     '''
     dd form=native |
     pad beg2=11 n2out=400 |
     put label1=t o1=0
         label2=r o2=0 d2=0.075
         label3=s o3=0 d3=0.150 |
     mutter half=n t0=0.5 v0=6 
     ''')

# infill shots
Flow('shoa','sraw',
     '''
     window n3=100 f3=300 |
     window f1=10 | 
     stretch inv=n rule=L |
     fft1    inv=n |
     transp plane=12 |
     transp plane=23
     ''')
Flow('shob','shoa','infill eps=1')
Flow('shot','shob',
     '''
     transp plane=23 |
     transp plane=12 |
     fft1    inv=y |
     stretch inv=y rule=L |
     pad beg1=10 
     ''')

# ------------------------------------------------------------
# CMPS
# ------------------------------------------------------------
Flow('cmps','shot',
     '''
     put d2=0.0375 |
     shot2cmp positive=n |
     window j3=2 min3=%(ox)g |
     put label2=h label3=m
     ''' % par )

# ------------------------------------------------------------
# WAVELET
# ------------------------------------------------------------
Flow('wave',None,
     '''
     spike nsp=1 mag=1 k1=%(kt)d
     n1=%(nt)d d1=%(dt)g o1=%(ot)g |
     ricker1 frequency=9
         ''' % wpar )    
Result('wave','wave','graph')

# ------------------------------------------------------------

wemig.sinking(par)

wemig.profile(par)

wemig.result(par)

End()
