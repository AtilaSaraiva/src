from rsfproj import *
# ------------------------------------------------------------
## 
 # Simple model
 ##
# ------------------------------------------------------------
par = {
    'nz':280, 'dz':4,     'oz':0, 'zmin':0, 'zmax':1120,
    'nx':320, 'dx':4,     'ox':0, 'xmin':0, 'xmax':1280,
    'nt':2000,'dt':0.0005,'ot':0,
    #
    'vo':1000,'gz':1.0,'gx':1.0,
    }
# ------------------------------------------------------------
# velocity
Flow('vel',None,
     '''
     spike nsp=1 mag=-750
           n1=%(nz)d d1=%(dz)g o1=%(oz)g k1=140 l1=180 unit1=m
           n2=%(nx)d d2=%(dx)g o2=%(ox)g k2=140 l2=180 unit2=m |
     math output="input + %(vo)g +
          %(gx)g*(x2-%(ox)g) +
          %(gz)g*(x1-%(oz)g)"
     ''' % par)
# ------------------------------------------------------------
# wavelet
Flow('wav',None,
     '''
     spike nsp=1 n1=%(nt)d d1=%(dt)g o1=%(ot)g |
     math output="exp(-10000*((x1-0.1)^2))" |
     halfint inv=y adj=n |
     halfint inv=y adj=y |
     bandpass flo=15 
     ''' % par)
# ------------------------------------------------------------
# sources
# use cube2list
Flow('soc',None,
     '''
     spike nsp=2 mag=1,-0.5
     n1=%(nz)d d1=%(dz)g o1=%(oz)g k1=200,210 l1=200,210
     n2=%(nx)d d2=%(dx)g o2=%(ox)g k2=075,100 l2=075,100
     ''' % par )
Flow('sou','soc','cube2list verb=y clip=0.01')

Flow('xs','sou','window j1=3 f1=0')
Flow('zs','sou','window j1=3 f1=1')
Flow('rs','sou','window j1=3 f1=2')
Flow('sss','xs zs',
     'cat axis=2 space=n ${SOURCES[1]} | transp | dd type=complex | window')
Plot('sou','sss',
     '''
     graph yreverse=y symbol=s wantaxis=n title=" "
     min1=%(xmin)g max1=%(xmax)g min2=%(zmin)g max2=%(zmax)g
     ''' %par)

# receivers
Flow('zr',None,
     '''
     math n1=200 d1=1 o1=0
     output="100+x1*%(dx)g+x1*%(dx)g/10*sin(x1*%(dx)g/50)"
     ''' % par)
Flow('xr',None,'math n1=200 d1=1 o1=0 output="600+0.75*x1*%(dx)g" ' % par)
Flow('rec','xr zr','cat axis=2 space=n ${SOURCES[1]} | transp')
Flow('rrr','xr zr',
     'cat axis=2 space=n ${SOURCES[1]} | transp | dd type=complex | window')
Plot('rec','rrr',
     '''
     graph yreverse=y symbol=r wantaxis=n title=" "
     min1=%(xmin)g max1=%(xmax)g min2=%(zmin)g max2=%(zmax)g
     ''' %par)
# ------------------------------------------------------------
## 
 # modeling
 ##
Flow('dat wfl','wav vel sou rec',
     '''
     afdm2d verb=y abc=y free=y snap=y jsnap=50
         nbz=50 tz=0.006125 nbx=50 tx=0.006125 
         vel=${SOURCES[1]}
         sou=${SOURCES[2]}
         rec=${SOURCES[3]}
         wfl=${TARGETS[1]}
     ''' % par)
# ------------------------------------------------------------
Plot('wfl',
     '''
     window n3=1 f3=14 |
     grey labelrot=n pclip=100
     title="Wavefield" label1="z" label2="x"
     min2=%(xmin)g max2=%(xmax)g min1=%(zmin)g max1=%(zmax)g title=" " 
     '''%par)
Plot('vel','vel',
     '''
     grey labelrot=n pclip=100 bias=1000 allpos=y
     title="Velocity" label1="z" label2="x"
     min2=%(xmin)g max2=%(xmax)g min1=%(zmin)g max1=%(zmax)g title=" " 
     '''%par)

Result('wfl','wfl sou rec','Overlay')
#Result('www','www sou rec','Overlay')
Result('vel','vel sou rec','Overlay')
Result('dat',
       '''
       grey labelrot=n pclip=100 title="Data"
       label1="receiver no" unit1= label2="time"
       ''')

# ------------------------------------------------------------
## 
 # Marmousi model
 ##
# ------------------------------------------------------------
mpar = {
    'nz':300,'dz':8,'oz':0,   'zmin':0,   'zmax':2400,
    'nx':500,'dx':8,'ox':4000,'xmin':4000,'xmax':8000,
    'nt':5000,'dt':0.0005,'ot':0
    }
Fetch(['marmvel.hh'],'marm')
# ------------------------------------------------------------
# wavelet
Flow('mwav',None,
     '''
     spike nsp=1 n1=%(nt)d d1=%(dt)g o1=%(ot)g |
     math output="exp(-10000*((x1-0.1)^2))" |
     halfint inv=y adj=y |
     halfint inv=n adj=y |
     bandpass flo=15 
     ''' % mpar)
# ------------------------------------------------------------
# velocity
Flow('mvel','marmvel.hh',
     '''
     dd form=native |
     window j1=2 j2=2 |
     window min1=%(oz)g n1=%(nz)g min2=%(ox)g n2=%(nx)g 
     '''%mpar)
# ------------------------------------------------------------
# sources
#Flow('mzs',None,'spike nsp=1 mag=0 n1=100 d1=1 o1=0 | math output="2200"' %mpar)
#Flow('mxs',None,'spike nsp=1 mag=0 n1=100 d1=1 o1=0 | math output="4300+4.*x1*%(dx)g"'   %mpar)
#Flow('mrs',None,'spike nsp=1 mag=0 n1=100 d1=1 o1=0 | math output="1"'    %mpar)
#Flow('msou','mxs mzs mrs','cat axis=2 space=n ${SOURCES[1]} ${SOURCES[2]} | transp')

Flow('msoc',None,
     '''
     spike nsp=1 mag=1
     n1=%(nz)d d1=%(dz)g o1=%(oz)g k1=250 l1=250
     n2=%(nx)d d2=%(dx)g o2=%(ox)g k2=050 l2=450
     ''' % mpar )
Flow('msou','msoc','cube2list verb=y clip=0.01 | window j2=4 ')
Flow('mxs','msou','window j1=3 f1=0')
Flow('mzs','msou','window j1=3 f1=1')
Flow('mrs','msou','window j1=3 f1=2')

Flow('msss','mxs mzs',    'cat axis=2 space=n ${SOURCES[1]} | transp | dd type=complex | window')
Plot('msou','msss',
     '''
     graph yreverse=y symbol=s wantaxis=n title=" "
     min1=%(xmin)g max1=%(xmax)g min2=%(zmin)g max2=%(zmax)g
     ''' % mpar)
# receivers
Flow('mzr',None,'spike nsp=1 mag=0 n1=300 d1=1 o1=0 | math output="100+2/3*x1*%(dz)g"' % mpar)
Flow('mxr',None,'spike nsp=1 mag=0 n1=300 d1=1 o1=0 | math output="7000-(x1*%(dz)g/10)^2/25"' %mpar)
Flow('mrec','mxr mzr','cat axis=2 space=n ${SOURCES[1]} | transp')
Flow('mrrr','mxr mzr','cat axis=2 space=n ${SOURCES[1]} | transp | dd type=complex | window')
Plot('mrec','mrrr',
     '''
     graph yreverse=y symbol=r wantaxis=n title=" "
     min1=%(xmin)g max1=%(xmax)g min2=%(zmin)g max2=%(zmax)g
     ''' %mpar)
# ------------------------------------------------------------
## 
 # modeling
 ##
Flow('mdat mwfl','mwav mvel msou mrec',
     '''
     afdm2d verb=y abc=y free=n snap=y jsnap=50
         nbz=50 tz=0.006125 nbx=50 tx=0.006125 
         vel=${SOURCES[1]}
         sou=${SOURCES[2]}
         rec=${SOURCES[3]}
         wfl=${TARGETS[1]}         
     ''' % par)
# ------------------------------------------------------------
Plot('mwfl',
     '''
     window n3=1 f3=28 |
     grey labelrot=n pclip=100
     title="Wavefield" label1="z" label2="x" unit1=m unit2=m
     min2=%(xmin)g max2=%(xmax)g min1=%(zmin)g max1=%(zmax)g title=" " 
     '''%mpar)
Plot('mvel','mvel',
     '''
     grey labelrot=n pclip=100 bias=1500 allpos=y
     title="Velocity" label1="z" label2="x"
     min2=%(xmin)g max2=%(xmax)g min1=%(zmin)g max1=%(zmax)g title=" " 
     '''%mpar)
Result('mwfl','mwfl msou mrec','Overlay')
Result('mvel','mvel msou mrec','Overlay')
Result('mdat',
       '''
       grey labelrot=n pclip=100 title="Data"
       label1="receiver no" unit1= label2="time"
       ''')

End()
