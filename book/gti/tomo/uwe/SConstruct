from rsfproj import *

private = {'login':os.environ.get('BEG_LOGIN'),
           'password':os.environ.get('BEG_PASSWORD'),
           'server':os.environ.get('BEG_SERVER')}

vel = 'velfile_@'

Fetch(vel,'bp',private)

Flow('vel','./'+vel,
     '''
     echo in=$SOURCE
     n1=512 n2=256
     d1=20  d2=10
     o1=0   o2=0
     label1=x label2=z
     unit1=m unit2=m
     label=Velocity unit=m/s
     data_format=xdr_float |
     dd form=native |
     transp
     ''',stdin=0)

def grey(title):
    return '''
    grey allpos=y bias=2000 scalebar=y color=j title="%s"
    clip=50 minval=2000 maxval=2050
    ''' % (title)

Result('vel',grey('Exact'))

# Forward modeling
Flow('time','vel','math output=1/input | tomo adj=n np=2001 ns=25 ds=20')

# Inversion
Flow('inv1','time','tomo adj=y rect1=1 rect2=1 | math output=1/input')

Result('inv1',grey('Estimated (no regularization)'))

Flow('inv2','time','tomo adj=y rect1=100 rect2=10 | math output=1/input')

Result('inv2',grey('Estimated (with regularization)'))

End()
