from rsfproj import *

# Creating models

# Linear v(z) 
Flow('mod',None,
     'math n1=201 d1=0.05 n2=501 d2=0.05 output="1/(1.5+0.2*x1)" ')

# Fast anomaly
Flow('const',None,'spike n1=201 d1=0.05 n2=501 d2=0.05 mag=0.5')
Flow('anom',None,
     '''
     spike n1=201 d1=0.05 n2=501 d2=0.05 k1=101 k2=251 mag=1000 |
     smooth rect1=50 rect2=100 | smooth rect1=50 rect2=100
     ''')
Flow('mod2','const anom','add ${SOURCES[1]}')
Flow('mod3','const anom','add scale=1,-1 ${SOURCES[1]}')

def grey(title):
    return '''
    grey color=j title=%s scalebar=y allpos=y clip=0.65
    minval=0.3 maxval=0.7
    ''' % title

par = {
    'mod': (10,300),
    'mod2': (10,10),
    'mod3': (100,100)
    }

for mod in ['mod','mod2','mod3']:
    inv = 'inv-'+mod
    
    Plot(mod,grey('Slowness'))

    # Forward modeling
    Flow('time-'+mod,mod,'tomo adj=n np=2001')

    # Inversion
    Flow(inv,'time-'+mod,'tomo adj=y rect1=%d rect2=%d' % par[mod])
    Plot(inv,grey('Reconstruction'))

    Result(inv,[mod,inv],'OverUnderAniso')

###########################################################################

End()
