from rsf.proj import *

sys.path.append('..')
import constant

constant.get_zodata('data')
Result('data','grey title="Zero Offset" ')

Flow('vel1','data','window n1=1 | math output=1 | spray axis=2 n=1500 d=0.004 o=0 label=Depth unit=km')

# Lowrank decomposition
Flow('fft','vel1','fft1 | fft3 axis=2 pad=1')
Flow('right left','vel1 fft',
     'scale dscale=0.5 | isolr2 seed=2012 dt=0.004 fft=${SOURCES[1]} left=${TARGETS[1]}')

# Zero-offset migration
Flow('mig1','data left right',
     '''
     halfint inv=y adj=y |
     reverse which=1 |
     transp |
     fftexp0 mig=y
     left=${SOURCES[1]} right=${SOURCES[2]}
     nz=1500 dz=0.004
     ''')

Result('mig1','window min2=0 max2=1.5 max1=3 | grey title="Zero-Offset Migration" unit1=km unit2=km')

# Impulse response

Flow('imp','data','spike k1=501 k2=175 | ricker1 frequency=10')

Flow('imig1','imp left right',
     '''
     halfint inv=y adj=y |
     reverse which=1 |
     transp |
     fftexp0 mig=y
     left=${SOURCES[1]} right=${SOURCES[2]}
     nz=1500 dz=0.004
     ''')

Result('imig1','window max1=1.5 | grey title="Impulse Response" unit1=km unit2=km')

End()
