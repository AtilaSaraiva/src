from rsf.proj import *

sys.path.append('..')
import constant

constant.get_zodata('data')
Result('data','grey title="Zero Offset" ')

Flow('vel','data','spike') # velocity=1

# Fourier transform and transpose

fmax = 50 # maximum frequency

Flow('fft','data',
     'fft1 | window max1=%g | transp plane=12 | transp plane=23' % fmax)

# From velocity to slowness
Flow('slowness','vel','transp | transp plane=23 | math output=1/input')

# Extended split-step migration
Flow('mig','fft slowness',
     '''
     zomig3 ompnth=1 mode=m --readwrite=y verb=y
     nrmax=1 slo=${SOURCES[1]} |
     window | transp
     ''',split=[3,'omp',[0]],reduce='add')

constant.zo_image('mig')

# Impulse response

Flow('imp','data',
     '''
     spike k1=501 k2=175 | ricker1 frequency=10 |
     fft1 | window max1=%g | 
     transp plane=12 | transp plane=23
     ''' % fmax)

Flow('imig','imp slowness',
     '''
     zomig3 ompnth=1 mode=m --readwrite=y verb=y
     nrmax=1 slo=${SOURCES[1]} |
     window | transp
     ''',split=[3,'omp',[0]],reduce='add')

Result('imig','window max1=1.5 | grey title="Impulse Response" unit1=km unit2=km')

End()
