from rsfproj import *

for case in Split('data mult ddata dmult'):
    segy = case + '.segy'
    Fetch(segy,'ray')
    Flow(case,segy,'segyread what=d')
    Plot(case,'grey wanttitle=n')

nt=251
ns=7

for c in ('','d'):
    mult = c+'mult'
    shifts = [mult]
    for s in range(1,ns):
        shift = '%sshift-%d' % (c,s)
        Flow(shift,mult,'window f1=%d | pad end1=%d' % (s,s))
        shifts.append(shift)

        shift = '%sshift+%d' % (c,s)
        Flow(shift,mult,'window n1=%d | pad beg1=%d' % (nt-s,s))
        shifts.append(shift)
    Flow(c+'shifts',shifts,'cat ${SOURCES[1:%d]}' % len(shifts))

    data = c+'data'
    pred = c+'pred'
    prim = c+'prim'
    filt = c+'filt'
    Flow([filt,pred],[c+'shifts',data],
         'lpf match=${SOURCES[1]} pred=${TARGETS[1]} rect1=10 rect2=3 niter=400')
    Flow(prim,[data,pred],'add scale=1,-1 ${SOURCES[1]}')

    Plot(prim,'grey wanttitle=n')
    Plot(pred,'grey wanttitle=n')

Result('planes','data mult prim pred','TwoRows')
Result('curves','ddata dmult dprim dpred','TwoRows')

End()
