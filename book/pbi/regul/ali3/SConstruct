from rsfproj import *


def cube(title,clip='',color='I'):
    return '''
    byte %s |
    grey3 frame1=100 frame2=60 frame3=50 color=%s
    flat=y point1=0.6 point2=0.6 title="%s"
    ''' % (clip,color,title)

Flow('qdome',None,
     '''
     qdome
     n1=200 d1=0.01 o1=0
     n2=151 d2=0.01 o2=0.4
     n3=101 d3=0.01 o3=-0.06 |
     smooth rect1=3 diff1=1 |
     smooth rect1=4
     ''')

Plot('qdome',cube('Original','clip=0.0015'))

Flow('dec','qdome','window j2=2 j3=2')

Plot('dec',cube('Decimated','clip=0.0015'))

Flow('dip','dec','dip rect1=3 rect2=3 rect3=3 nj1=2 nj2=2')

Flow('res','dec dip','dealias dip=${SOURCES[1]}')

Plot('res',cube('Restored','clip=0.0015'))

Plot('err','qdome res',
     'add scale=-1,1 ${SOURCES[1]} | ' + cube('Error','clip=0.0015'))

Result('qdome','qdome dec res err','TwoRows')

End()
