from rsfproj import *

vel = 'huskyvelo.HH'

# Plot velocity

Fetch(vel,'husky')
Flow('husky',vel,'dd form=native')
Plot('husky',
     '''
     grey color=j allpos=y scalebar=y title=Velocity
     barreverse=y bias=3000
     ''')
Result('husky','husky','Overlay')

# Compute gradient

Flow('edge','husky','igrad square=y')

Result('edge','edge',
       '''
       grey allpos=y title=Edges
       ''')

# Select and plot x and y pairs

nz=731
nx=1443

Flow('mask','edge','mask min=1')

for x in ('x1','x2'):
    Flow(x,'edge mask',
         '''
         math output=%s |
         put n1=1 n2=%d |
         headerwindow mask=${SOURCES[1]} |
         window
         ''' % (x,nz*nx))

Flow('x','x1 x2','cmplx ${SOURCES[:2]}',stdin=0)
Plot('x',
     '''
     graph symbol=x transp=y yreverse=y scalebar=y
     min1=-1800 max1=%d min2=2000 max2=%d plotcol=7
     wantaxis=n wanttitle=n
     ''' % (-1800+(nz-1)*10,2000+(nx-1)*10))


Result('huskyx','husky x','Overlay')

End()
