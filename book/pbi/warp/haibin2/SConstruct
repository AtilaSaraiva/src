from rsfproj import *
import warp

data = {
    'pp': 'pz_221.sgy',
    'ps': '221_PS_PSTM_FullLine_STK_MSL_segy.sgy'
    }

import os
private = {'login':os.environ.get('BEG_LOGIN'),
           'password':os.environ.get('BEG_PASSWORD'),
           'server':os.environ.get('BEG_SERVER')}

o2 = {'ps': 15507,'pp': 15513}

for mode in ['pp','ps']:
    Fetch(data[mode],'haibin',private)
    Flow(['./'+mode+'0','./'+mode+'hhead','./'+mode+'bhead',mode+'head'],
         data[mode],
         '''
         segyread tape=$SOURCE tfile=${TARGETS[3]}
         hfile=${TARGETS[1]} bfile=${TARGETS[2]} |
         put o2=%g d2=2
         ''' % o2[mode],stdin=0)
    Flow(mode,mode+'0','window min2=15513 max2=21837')
    Result(mode,'grey title=%s label1="Time (s)" ' % string.upper(mode))

Fetch('gamma.rsf','haibin',private)
Flow('warp0','gamma.rsf pp',
     '''
     dd form=native |
     smooth rect1=10 | smooth rect1=10 |
     math output="(input+1)*x1/2" |
     spline pattern=${SOURCES[1]} |
     math output=input-x1 |
     spray axis=2 o=15513 d=2 n=3163
     ''')

warp.warp2('hai','pp','ps','warp0',
           nx=3163,
           tmax=3,
           inter=2,
           trace=17513,
           dt=0.004,
           g0=0.9,
           gmin=2,
           gmax=3,
           ng=51,
           rect1=50,
           rect2=50,
           fmin=10,
           fmax=50,
           frame1=400,
           iter=2,
           clip=11.33)

End()
