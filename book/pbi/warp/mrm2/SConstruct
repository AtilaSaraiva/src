from rsfproj import *
import warp

mods = ['vp','vs','density']
for case in mods:
    segy = case + '_marmousi-ii.segy'
    Fetch(segy,'marm2')

    Flow(case,segy,
         '''
         segyread tape=$SOURCE read=data |
         put d1=0.00125 o1=0 d2=0.00125 o2=0 > $TARGET &&
         /bin/rm header binary
         ''',
         stdin=0,stdout=-1)

Flow('ref',mods,
     '''
     cat ${SOURCES[1:3]} |
     window f1=361 |
     transp plane=23 memsize=500 |
     modrefl2 nt=2501 dt=0.002
     ''')

freq = {
    'pp': ['5,10,60,80','17.5'], #,'35'],
    'ps': ['2.5,5,30,40','8.75'] #'17.5']
    }
window = {
    'pp': 'n1=1251',
    'ps': 'f2=2'
    }

for mode in ('pp','ps'):
    grey = 'grey title=%s' % string.upper(mode)
    for case in range(2):
        modec = mode+str(case)
        Flow(modec,'ref','window n2=1 %s | ' % window[mode] +
             ('trapez frequency=%s','ricker1 frequency=%s')[case] %
             freq[mode][case])
        Result(modec,grey)
        win = modec+'win'
        Flow(win,modec,'window max2=5 | scale axis=2')
        Result(win,grey)

gamma = 2
Flow('warp0','pp1win','math output="%g*x1" ' % (0.5*(gamma-1)))

warp.warp2('mrm','pp1win','ps1win','warp0',
           nx=4001,
           tmax=2.5,
           inter=1,
           j2=4,
           trace=3,
           dt=0.002,
           g0=0.8,
           gmin=1,
           gmax=3,
           ng=101,
           rect1=100,
           rect2=25,
           fmin=0,
           fmax=20,
           frame1=350,
           iter=2,
           clip=0.035)

End()
