from rsfproj import *

Flow('ricker',None,'spike n1=101 k1=51 | ricker1')

traces = []
for a in range(-180,190,10):
    ricker = 'ricker%d' % a
    histog = 'histog%d' % a
    traces.append(ricker)
    Flow(ricker,'ricker','envelope hilb=y phase=%d' % a)
    Flow(histog,ricker,
         'window min1=0.1 max1=0.3 | histogram n1=11 o1=-0.25 d1=0.05')

Flow('traces',traces,
     'cat ${SOURCES[1:%d]} axis=2 | put o2=-180 d2=10' % len(traces))
Result('traces','dots')

Flow('histos','histog0 histog90','cat ${SOURCES[1]} axis=2')
Result('histos',
       '''
       interleave axis=1 %s |
       dd type=float |
       graph dash=1,0 title=Histogram wantaxis1=n
       ''' % ('$SOURCE '*10))

Flow('focus','traces','focus rect1=50')
Result('focus','grey allpos=y color=j pclip=100 title=Focus')

Flow('envelope','ricker','envelope | spray axis=2 n=37')

Flow('envcorr','traces envelope',
     'similarity other=${SOURCES[1]} rect1=100')

Result('envcorr',
       '''
       grey allpos=y color=j title="Envelope Correlation"
       ''')

Flow('envpick','envcorr',
     'window min2=-90 max2=90 | scale axis=2 | pick rect1=100')

Flow('num','traces','math output="input^4" | stack axis=1 norm=no')
Flow('den','traces',
     '''
     math output="input*input" |
     stack axis=1 norm=no |
     math output="input*input"
     ''')
Result('zerop','num den','add mode=d | graph')

Flow('spike',None,
     '''
     spike n1=129 n2=129 d1=0.004 d2=0.008
     nsp=3 k1=50,75,100 k2=50,75,100 |
     bandpass flo=10 fhi=50
     ''')
Flow('fft2','spike','cosft sign2=1')
Flow('stolt','fft2','stolt nf=4 vel=2 | cosft sign2=-1')

for vel in (3,4,5):
    back = 'back%d' % vel
    Flow(back,'stolt','cosft sign2=1 | stolt nf=4 vel=-%d | cosft sign2=-1' % vel)
    num = 'num%d' % vel
    den = 'den%d' % vel
    rat = 'rat%d' % vel
    Flow(num,back,
         'math output="input^4" | stack axis=2 norm=no | stack axis=1 norm=no')
    Flow(den,back,
         '''
         math output="input*input" |
         stack axis=2 norm=no |
         stack axis=1 norm=no |
         math output="input*input"
         ''')
    Flow(rat,[num,den],'add mode=d')

End()
