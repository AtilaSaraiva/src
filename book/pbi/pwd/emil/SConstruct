from rsfproj import *

import os
private = {'login':os.environ.get('BEG_LOGIN'),
           'password':os.environ.get('BEG_PASSWORD'),
           'server':os.environ.get('BEG_SERVER')}

Fetch('emil2.sht','emil',private)

Flow('emil temil','emil2.sht',
     'segyread tape=$SOURCE su=1 endian=0 tfile=${TARGETS[1]}',stdin=0)
Flow('emil1','emil','window n2=120')
Flow('emil2','emil','window f2=120')

Flow('offset','temil',
     'window n2=120 | dd type=float | headermath output=offset | window')

grey = 'grey label1="Time (s)" label2=Trace wanttitle=n'

Plot('emil1',grey)
Plot('emil2',grey)
Result('emil','emil1 emil2','SideBySideAniso')

Flow('noiz','emil1',
     'bandpass fhi=5 nphi=12 | mutter x0=60 half=n v0=40')
Flow('mask','noiz',
     'math output="input*input" | smooth rect1=5 rect2=5 | mask min=0.01')
Flow('mask2','mask','dd type=float')
Flow('dat2','emil1 mask2','add mode=p ${SOURCES[1]}')

Flow('sign','emil1','bandpass flo=5 nplo=12')

Plot('noiz',grey + ' wanttitle=y title=Bandpassed')

Flow('ndip','noiz','dip rect1=50 rect2=10')
Flow('sdip','sign','dip rect1=50 rect2=10')
Flow('dip','dat2 sdip ndip mask',
     '''
     twodip2 eps=10 lam=10 gauss=n
     dip1=${SOURCES[1]} dip2=${SOURCES[2]} mask=${SOURCES[3]}
     ''')
Flow('sdip1','dip','window n3=1')
Flow('ndip1','dip','window f3=1')

Flow('signoi','dat2 sdip1 ndip1',
     '''
     planesignoi sdip=${SOURCES[2]} ndip=${SOURCES[1]}
     eps=0.01 verb=y niter=100
     ''')
Flow('noi','signoi','window f3=1')
Flow('sig','signoi mask emil1 dat2',
     '''
     window n3=1 |
     add mode=p ${SOURCES[1]} | add scale=1,1,-1 ${SOURCES[2:4]}
     ''')
     
###########################################################################
End()
