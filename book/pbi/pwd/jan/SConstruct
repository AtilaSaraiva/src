from rsfproj import *

lines = ('Inl20025-Xln2982-2988-Time.SEGY',
         'Inl20025-Xln3370-3376-Time.SEGY',
         'Inl20025-Xln2982-2988-Depth.SEGY',
         'Inl20025-Xln3370-3376-Depth.SEGY',)

import os
private = {'login':os.environ.get('BEG_LOGIN'),
           'password':os.environ.get('BEG_PASSWORD'),
           'server':os.environ.get('BEG_SERVER')}

for case in range(len(lines)):
    line = 'line%d' % case
    test = 'test%d' % case
    head = 'head%d' % case
    data = 'data%d' % case
    inpt = lines[case]
    Fetch(inpt,'hydro',private)
    Flow([line,'./h'+head,'./b'+head,head],inpt,
         '''
         segyread tape=$SOURCE
         hfile=${TARGETS[1]} bfile=${TARGETS[2]} tfile=${TARGETS[3]}
         ''',stdin=0)
    Flow(test,line,'intbin xk=cdpt yk=cdp')     
    Flow(data,test,'window n3=1 min1=5 max1=8 | bandpass fhi=25')
    Plot(data,
         'grey title=Input clip=1591620 label2=Channel label1=%s' %
         ('Time','Time','Depth','Depth')[case])

Flow('mask','data2',
     '''
     math output=1 |
     window f1=100 |
     mutter t0=6 v0=65 hyper=y |
     pad beg1=100
     ''')
Flow('dat2','data2 mask','add mode=p ${SOURCES[1]}')

Flow('nmo2','data2','pad beg1=140 | nmostretch v0=18 half=n')
Plot('nmo2','grey title=NMO clip=1591620 label2=Channel label1=Depth')

Flow('nmask','mask','pad beg1=140 | nmostretch v0=18 half=n')

Result('data2','data2 nmo2','SideBySideAniso')

Flow('ddip2','nmo2',
     'twodip2 order=3 eps=10 gauss=n verb=y sign=1 q0=-1')
Plot('ndip2','ddip2',
     'window n3=1 | grey title="Noise Slope" color=j scalebar=y')
Plot('sdip2','ddip2',
     'window f3=1 | grey title="Signal Slope" color=j scalebar=y')
Result('ddip2','ndip2 sdip2','SideBySideAniso')

Flow('nsep2','nmo2 ddip2','pwdsigk dips=${SOURCES[1]} verb=y niter=200')

Flow('nmo2s','nmo2','pad n2=64')
Flow('ddip2s','ddip2','transp | remap1 n1=64 | transp')

Flow('nsep2s','nmo2s ddip2s','seisigk dips=${SOURCES[1]} verb=y niter=200 eps=0.01 | window n2=62')

Flow('nnoi2','nsep2','window n3=1')
Plot('nnoi2','grey title="Estimated Noise" clip=1591620')

Flow('ssig2','nsep2','window f3=1')
Plot('ssig2','grey title="Estimated Signal" clip=1591620')

Result('nsep2','nmo2 nnoi2 ssig2','SideBySideAniso')

Flow('nnoi2s','nsep2s','window n3=1')
Plot('nnoi2s','grey title="Estimated Noise" clip=1591620')

Flow('ssig2s','nsep2s','window f3=1')
Plot('ssig2s','grey title="Estimated Signal" clip=1591620')

Result('nsep2s','nmo2 nnoi2 ssig2','SideBySideAniso')

Flow('noi2','nnoi2','nmostretch v0=18 half=n inv=y | window f1=140')
Plot('noi2','grey title="Estimated Noise" clip=1591620')

Flow('sig2','ssig2','nmostretch v0=18 half=n inv=y | window f1=140')
Plot('sig2','grey title="Estimated Signal" clip=1591620')

Result('sep2','data2 noi2 sig2','SideBySideAniso')

Flow('noi2s','nnoi2s','nmostretch v0=18 half=n inv=y | window f1=140')
Plot('noi2s','grey title="Estimated Noise" clip=1591620')

Flow('sig2s','ssig2s','nmostretch v0=18 half=n inv=y | window f1=140')
Plot('sig2s','grey title="Estimated Signal" clip=1591620')

Result('sep2s','data2 noi2s sig2s','SideBySideAniso')

Flow('dip','data2 mask',
     'twodip2 order=3 eps=10 gauss=n verb=y mask=${SOURCES[1]}')

Flow('signoi','data2 dip',
     'pwdsigk dips=${SOURCES[1]} verb=y niter=200 | bandpass fhi=40')

Flow('sig','signoi','window f3=1')
Plot('sig','grey title="Estimated Signal" clip=1591620')

Flow('noi','data2 sig','add scale=1,-1 ${SOURCES[1]}')
Plot('noi','grey title="Estimated Noise" clip=1591620')

Result('test2','data2 sig noi','SideBySideAniso')

Result('hydro','data2 data3','SideBySideAniso')

###########################################################################
End()
