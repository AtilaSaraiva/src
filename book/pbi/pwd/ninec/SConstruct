from rsfproj import *

for case in ('P','X','Y','Z'):
    sgy = 'rec_gather_%s.sgy' % case
    Fetch(sgy,'ninec')
    Flow([case,'./h'+case,'./b'+case,'t'+case],sgy,
         '''
         segyread tape=$SOURCE hfile=${TARGETS[1]}
         bfile=${TARGETS[2]} tfile=${TARGETS[3]}
         ''',stdin=0)
    bin='bin'+case
    offset = 'offset'+case
    Flow(offset,'t'+case,'dd type=float | headermath output=sy-gy')
    Flow(bin,[case,offset],
         '''
         transp |
         bin1 head=${SOURCES[1]} x0=-2500 nx=101 dx=50 interp=2 |
         transp
         ''')
    Result(bin,'grey title="%s component" ' % case)
    scan='scan'+case
    Flow(scan,bin,'vscan v0=500 dv=25 nv=100 semblance=y half=n')
    Result(scan,
           '''
           grey color=j
           label2="Velocity (m/s)" title="%s Velocity Scan"
           allpos=y
           ''' % case)
    
t0 = 0.6
v0 = 1500

Flow('datum','binP',
     'window n1=1 | math output="sqrt(%g+x1*x1*%g)" ' % (t0*t0,1./(v0*v0)))
Flow('dat','binP datum','datstretch datum=${SOURCES[1]}')
Result('dat','grey title="Reduced" ')

Flow('bak','dat','bandpass flo=10 fhi=125')
Result('bak','grey title="Filtered" ')

Flow('bakP','bak datum','datstretch inv=y datum=${SOURCES[1]}')
Result('bakP','grey title="Filtered" ')

End()
