import os
thispath = os.getcwd()
env = Environment();
Decider('make')

papername = 'paper1'
texsources = ['demo.tex', 'suplot.tex'] 
bibname = 'masterref'

def ltx(target, source, env):
    lname = str(source[0])
    name = (lname.split('.'))[0]
    f = open(papername+'.ltx','w')
    f.write('\documentclass [12pt]{georeport}\n\n')
    g = open(name + '.fmt','r')
    for line in g.read():
        f.write(line)
    g.close()
    f.write('\\begin{document}\n\n')
    for i in range(len(source)):
        f.write('\\input{' + str(source[i]) + '}\n')
    f.write('\end{document}\n')
    f.close()

def paper(target, source, env): 
    lname = str(source[0])
    name = (lname.split('.'))[0]
    os.system('latex ' + name + '.ltx; bibtex ' + name + '; latex ' + name + '.ltx; latex ' + name + '.ltx')

def final(target, source, env):
    os.system('dvipdf ' + str(source[0]))

t_ltx = env.Command([papername + '.ltx'], texsources, ltx)

t_paper = env.Command([papername + '.dvi'], [papername + '.ltx'], paper)
Clean(t_paper,[papername + '.aux', papername + '.bbl', papername + '.log', papername + '.blg'])

t_final = env.Command([papername + '.pdf'], [papername + '.dvi'], final)

#Depends(t_paper, [t_ltx])

#Depends(t_final, [t_paper])

